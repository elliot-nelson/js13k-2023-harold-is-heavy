<meta charset="utf8"><style>body,html{margin:0;padding:0;background-color:#000}div{position:absolute;top:0;bottom:0;left:0;right:0}#canvas{width:100%;height:100%;touch-action:none}</style><div><canvas id="canvas"></canvas></div><script>(function () {
    'use strict';

    // Constants

    // The game's desired dimensions in pixels - the actual dimensions can be adjusted
    // slightly by the Viewport module.
    const TARGET_GAME_WIDTH = 240;
    const TARGET_GAME_HEIGHT = 135;

    // Size in pixels of each map tile
    const TILE_SIZE = 8;

    // Modes (touch vs mouse cursor)
    const INPUT_MODE_TOUCH = 1;
    const INPUT_MODE_MOUSE = 2;
    const TILE_WALL_TOP = 9;
    const TILE_WALL_RIGHT = 10;
    const TILE_WALL_BOTTOM = 11;
    const TILE_WALL_LEFT = 12;
    const TILE_CORNER_OUTER = 13;
    const TILE_CORNER_INNER = 14;
    const TILE_DYNAMIC = 20;

    // Some pre-calculated radian values
    const R0          =   0;
    const R45         =  45 * Math.PI / 180;
    const R90         =  90 * Math.PI / 180;
    const R180        = 180 * Math.PI / 180;

    const FPS = 60;

    // Player movement constants
    const PLAYER_FOOT_SPEED = 1.3;
    const JUMP_HEIGHT = 3.5 * TILE_SIZE;
    const JUMP_HEIGHT_DISTANCE = 2 * TILE_SIZE;
    const JUMP_VELOCITY = -2 * JUMP_HEIGHT * PLAYER_FOOT_SPEED / JUMP_HEIGHT_DISTANCE;

    // Gravity
    const GRAVITY = 2 * JUMP_HEIGHT * PLAYER_FOOT_SPEED * PLAYER_FOOT_SPEED / (JUMP_HEIGHT_DISTANCE * JUMP_HEIGHT_DISTANCE);
    const TERMINAL_VELOCITY = 5;

    // If the bounding box of a jumping character hits a platform and the feet of
    // the character are within this many pixels of the top of the floor, pretend
    // that they "made the jump".
    const JUMP_CHEAT_Y_PIXELS = 2;

    // Tapping jump before you've landed will trigger another jump if you're
    // "about" to land on the ground (within this many frames).
    const JUMP_CHEAT_LANDING_FRAMES = 8;

    // How many pixels you must fall to super slam
    const SUPER_SLAM_FALL_DISTANCE = 72;

    // Viewport

    /**
     * Viewport
     *
     * Represents the game display (for us, a canvas).
     */
    const Viewport = {
        init() {
            Viewport.canvas = document.getElementById('canvas');
            Viewport.ctx = Viewport.canvas.getContext('2d');
            Viewport.resize(true);
        },

        // Resize the canvas to give us approximately our desired game display size.
        //
        // Rather than attempt to explain it, here's a concrete example:
        //
        //     we start with a desired game dimension:   480x270px
        //          get the actual browser dimensions:  1309x468px
        //          factor in the display's DPR ratio:  2618x936px
        //         now calculate the horizontal scale:       5.45x
        //                     and the vertical scale:       3.46x
        //            our new offical game scaling is:        5.4x
        //       and our official viewport dimensions:   484x173px
        //
        // This approach emphasizes correct aspect ratio and maintains full-window rendering, at
        // the potential cost of limiting visibility of the game itself in either the X or Y axis.
        // If you use this approach, make sure your GUI can "float" (otherwise there may be whole
        // UI elements the player cannot see!).
        resize(force) {
            let dpr = window.devicePixelRatio,
                width = Viewport.canvas.clientWidth,
                height = Viewport.canvas.clientHeight,
                dprWidth = width * dpr,
                dprHeight = height * dpr;

            if (
                force ||
                Viewport.canvas.width !== dprWidth ||
                Viewport.canvas.height !== dprHeight
            ) {
                Viewport.canvas.width = dprWidth;
                Viewport.canvas.height = dprHeight;

                Viewport.scale = ((Math.min(dprWidth / TARGET_GAME_WIDTH, dprHeight / TARGET_GAME_HEIGHT) * 10) | 0) / 10;
                Viewport.width = Math.ceil(dprWidth / Viewport.scale);
                Viewport.height = Math.ceil(dprHeight / Viewport.scale);
                Viewport.center = {
                    u: (Viewport.width / 2) | 0,
                    v: (Viewport.height / 2) | 0
                };
                Viewport.clientWidth = width;
                Viewport.clientHeight = height;

                // Note: smoothing flag gets reset on every resize by some browsers, which is why
                // we do it here.
                Viewport.ctx.imageSmoothingEnabled = false;
            }

            // We do this every frame, not just on resize, due to browser sometimes "forgetting".
            Viewport.canvas.style.cursor = 'none';
        },

        fillViewportRect() {
            Viewport.ctx.fillRect(0, 0, Viewport.width, Viewport.height);
        },

        isOnScreen(uv) {
            return uv.u >= 0 && uv.v >= 0 && uv.u < Viewport.width && uv.v < Viewport.height;
        }
    };

    /*

    ZzFX - Zuper Zmall Zound Zynth v1.1.8
    By Frank Force 2019
    https://github.com/KilledByAPixel/ZzFX

    ZzFX Features

    - Tiny synth engine with 20 controllable parameters.
    - Play sounds via code, no need for sound assed files!
    - Compatible with most modern web browsers.
    - Small code footprint, the micro version is under 1 kilobyte.
    - Can produce a huge variety of sound effect types.
    - Sounds can be played with a short call. zzfx(...[,,,,.1,,,,9])
    - A small bit of randomness appied to sounds when played.
    - Use ZZFX.GetNote to get frequencies on a standard diatonic scale.
    - Sounds can be saved out as wav files for offline playback.
    - No additional libraries or dependencies are required.

    */

    // zzfx object with some extra functionalty
    const ZZFX = {
        // master volume scale
        volume: .3,

        // sample rate for audio
        sampleRate: 44100,

        // create shared audio context
        x: new (window.AudioContext || webkitAudioContext),

        destination: undefined,

        // play a sound from zzfx paramerters
        play: function(...parameters)
        {
            // build samples and start sound
            return this.playSamples(this.buildSamples(...parameters));
        },

        // play an array of samples
        playSamples: function(...samples)
        {
            // create buffer and source
            const buffer = this.x.createBuffer(samples.length, samples[0].length, this.sampleRate),
                source = this.x.createBufferSource();

            samples.map((d,i)=> buffer.getChannelData(i).set(d));
            source.buffer = buffer;
            source.connect(this.destination);
            source.start();
            return source;
        },

        // build an array of samples
        buildSamples: function
        (
            volume = 1,
            randomness = .05,
            frequency = 220,
            attack = 0,
            sustain = 0,
            release = .1,
            shape = 0,
            shapeCurve = 1,
            slide = 0,
            deltaSlide = 0,
            pitchJump = 0,
            pitchJumpTime = 0,
            repeatTime = 0,
            noise = 0,
            modulation = 0,
            bitCrush = 0,
            delay = 0,
            sustainVolume = 1,
            decay = 0,
            tremolo = 0
        )
        {
            // init parameters
            const PI2 = Math.PI*2;
            let sampleRate = this.sampleRate,
            sign = v => v>0?1:-1,
            startSlide = slide *= 500 * PI2 / sampleRate / sampleRate,
            startFrequency = frequency *=
                (1 + randomness*2*Math.random() - randomness) * PI2 / sampleRate,
            b=[], t=0, tm=0, i=0, j=1, r=0, c=0, s=0, f, length;

            // scale by sample rate
            attack = attack * sampleRate + 9; // minimum attack to prevent pop
            decay *= sampleRate;
            sustain *= sampleRate;
            release *= sampleRate;
            delay *= sampleRate;
            deltaSlide *= 500 * PI2 / sampleRate**3;
            modulation *= PI2 / sampleRate;
            pitchJump *= PI2 / sampleRate;
            pitchJumpTime *= sampleRate;
            repeatTime = repeatTime * sampleRate | 0;

            // generate waveform
            for(length = attack + decay + sustain + release + delay | 0;
                i < length; b[i++] = s)
            {
                if (!(++c%(bitCrush*100|0)))                      // bit crush
                {
                    s = shape? shape>1? shape>2? shape>3?         // wave shape
                        Math.sin((t%PI2)**3) :                    // 4 noise
                        Math.max(Math.min(Math.tan(t),1),-1):     // 3 tan
                        1-(2*t/PI2%2+2)%2:                        // 2 saw
                        1-4*Math.abs(Math.round(t/PI2)-t/PI2):    // 1 triangle
                        Math.sin(t);                              // 0 sin

                    s = (repeatTime ?
                            1 - tremolo + tremolo*Math.sin(PI2*i/repeatTime) // tremolo
                            : 1) *
                        sign(s)*(Math.abs(s)**shapeCurve) *       // curve 0=square, 2=pointy
                        volume * this.volume * (                  // envelope
                        i < attack ? i/attack :                   // attack
                        i < attack + decay ?                      // decay
                        1-((i-attack)/decay)*(1-sustainVolume) :  // decay falloff
                        i < attack  + decay + sustain ?           // sustain
                        sustainVolume :                           // sustain volume
                        i < length - delay ?                      // release
                        (length - i - delay)/release *            // release falloff
                        sustainVolume :                           // release volume
                        0);                                       // post release

                    s = delay ? s/2 + (delay > i ? 0 :            // delay
                        (i<length-delay? 1 : (length-i)/delay) *  // release delay
                        b[i-delay|0]/2) : s;                      // sample delay
                }

                f = (frequency += slide += deltaSlide) *          // frequency
                    Math.cos(modulation*tm++);                    // modulation
                t += f - f*noise*(1 - (Math.sin(i)+1)*1e9%2);     // noise

                if (j && ++j > pitchJumpTime)       // pitch jump
                {
                    frequency += pitchJump;         // apply pitch jump
                    startFrequency += pitchJump;    // also apply to start
                    j = 0;                          // stop pitch jump time
                }

                if (repeatTime && !(++r % repeatTime)) // repeat
                {
                    frequency = startFrequency;     // reset frequency
                    slide = startSlide;             // reset slide
                    j = j || 1;                     // reset pitch jump time
                }
            }

            return b;
        },

        // get frequency of a musical note on a diatonic scale
        getNote: function(semitoneOffset=0, rootNoteFrequency=440)
        {
            return rootNoteFrequency * 2**(semitoneOffset/12);
        }

    }; // ZZFX

    /* -*- mode: javascript; tab-width: 4; indent-tabs-mode: nil; -*-
    *
    * Copyright (c) 2011-2013 Marcus Geelnard
    *
    * This software is provided 'as-is', without any express or implied
    * warranty. In no event will the authors be held liable for any damages
    * arising from the use of this software.
    *
    * Permission is granted to anyone to use this software for any purpose,
    * including commercial applications, and to alter it and redistribute it
    * freely, subject to the following restrictions:
    *
    * 1. The origin of this software must not be misrepresented; you must not
    *    claim that you wrote the original software. If you use this software
    *    in a product, an acknowledgment in the product documentation would be
    *    appreciated but is not required.
    *
    * 2. Altered source versions must be plainly marked as such, and must not be
    *    misrepresented as being the original software.
    *
    * 3. This notice may not be removed or altered from any source
    *    distribution.
    *
    */

    // Some general notes and recommendations:
    //  * This code uses modern ECMAScript features, such as ** instead of
    //    Math.pow(). You may have to modify the code to make it work on older
    //    browsers.
    //  * If you're not using all the functionality (e.g. not all oscillator types,
    //    or certain effects), you can reduce the size of the player routine even
    //    further by deleting the code.


    const CPlayer = function() {

        //--------------------------------------------------------------------------
        // Private methods
        //--------------------------------------------------------------------------

        // Oscillators
        var osc_sin = function (value) {
            return Math.sin(value * 6.283184);
        };

        var osc_saw = function (value) {
            return 2 * (value % 1) - 1;
        };

        var osc_square = function (value) {
            return (value % 1) < 0.5 ? 1 : -1;
        };

        var osc_tri = function (value) {
            var v2 = (value % 1) * 4;
            if(v2 < 2) return v2 - 1;
            return 3 - v2;
        };

        var getnotefreq = function (n) {
            // 174.61.. / 44100 = 0.003959503758 (F3)
            return 0.003959503758 * (2 ** ((n - 128) / 12));
        };

        var createNote = function (instr, n, rowLen) {
            var osc1 = mOscillators[instr.i[0]],
                o1vol = instr.i[1],
                o1xenv = instr.i[3]/32,
                osc2 = mOscillators[instr.i[4]],
                o2vol = instr.i[5],
                o2xenv = instr.i[8]/32,
                noiseVol = instr.i[9],
                attack = instr.i[10] * instr.i[10] * 4,
                sustain = instr.i[11] * instr.i[11] * 4,
                release = instr.i[12] * instr.i[12] * 4,
                releaseInv = 1 / release,
                expDecay = -instr.i[13]/16,
                arp = instr.i[14],
                arpInterval = rowLen * (2 **(2 - instr.i[15]));

            var noteBuf = new Int32Array(attack + sustain + release);

            // Re-trig oscillators
            var c1 = 0, c2 = 0;

            // Local variables.
            var j, j2, e, rsample, o1t, o2t;

            // Generate one note (attack + sustain + release)
            for (j = 0, j2 = 0; j < attack + sustain + release; j++, j2++) {
                if (j2 >= 0) {
                    // Switch arpeggio note.
                    arp = (arp >> 8) | ((arp & 255) << 4);
                    j2 -= arpInterval;

                    // Calculate note frequencies for the oscillators
                    o1t = getnotefreq(n + (arp & 15) + instr.i[2] - 128);
                    o2t = getnotefreq(n + (arp & 15) + instr.i[6] - 128) * (1 + 0.0008 * instr.i[7]);
                }

                // Envelope
                e = 1;
                if (j < attack) {
                    e = j / attack;
                } else if (j >= attack + sustain) {
                    e = (j - attack - sustain) * releaseInv;
                    e = (1 - e) * (3 ** (expDecay * e));
                }

                // Oscillator 1
                c1 += o1t * e ** o1xenv;
                rsample = osc1(c1) * o1vol;

                // Oscillator 2
                c2 += o2t * e ** o2xenv;
                rsample += osc2(c2) * o2vol;

                // Noise oscillator
                if (noiseVol) {
                    rsample += (2 * Math.random() - 1) * noiseVol;
                }

                // Add to (mono) channel buffer
                noteBuf[j] = (80 * rsample * e) | 0;
            }

            return noteBuf;
        };


        //--------------------------------------------------------------------------
        // Private members
        //--------------------------------------------------------------------------

        // Array of oscillator functions
        var mOscillators = [
            osc_sin,
            osc_square,
            osc_saw,
            osc_tri
        ];

        // Private variables set up by init()
        var mSong, mLastRow, mCurrentCol, mNumWords, mMixBuf, mChannelBufs;


        //--------------------------------------------------------------------------
        // Initialization
        //--------------------------------------------------------------------------

        this.init = function (song) {
            // Define the song
            mSong = song;

            // Init iteration state variables
            mLastRow = song.endPattern;
            mCurrentCol = 0;

            // Prepare song info
            mNumWords =  song.rowLen * song.patternLen * (mLastRow + 1) * 2;

            // Create work buffer (initially cleared)
            mMixBuf = new Int32Array(mNumWords);

            mChannelBufs = [];

            for (let i = 0; i < song.numChannels; i++) {
                mChannelBufs.push(new Int32Array(mNumWords));
            }
        };


        //--------------------------------------------------------------------------
        // Public methods
        //--------------------------------------------------------------------------

        // Generate audio data for a single track
        this.generate = function () {
            // Local variables
            var i, j, p, row, col, n, cp,
                k, t, rsample, rowStartSample, f;

            // Put performance critical items in local variables
            var chnBuf = new Int32Array(mNumWords),
                instr = mSong.songData[mCurrentCol],
                rowLen = mSong.rowLen,
                patternLen = mSong.patternLen;

            // Clear effect state
            var low = 0, band = 0, high;
            var lsample, filterActive = false;

            // Clear note cache.
            var noteCache = [];

             // Patterns
             for (p = 0; p <= mLastRow; ++p) {
                cp = instr.p[p];

                // Pattern rows
                for (row = 0; row < patternLen; ++row) {
                    // Execute effect command.
                    var cmdNo = cp ? instr.c[cp - 1].f[row] : 0;
                    if (cmdNo) {
                        instr.i[cmdNo - 1] = instr.c[cp - 1].f[row + patternLen] || 0;

                        // Clear the note cache since the instrument has changed.
                        if (cmdNo < 17) {
                            noteCache = [];
                        }
                    }

                    // Put performance critical instrument properties in local variables
                    var oscLFO = mOscillators[instr.i[16]],
                        lfoAmt = instr.i[17] / 512,
                        lfoFreq = (2 ** (instr.i[18] - 9)) / rowLen,
                        fxLFO = instr.i[19],
                        fxFilter = instr.i[20],
                        fxFreq = instr.i[21] * 43.23529 * 3.141592 / 44100,
                        q = 1 - instr.i[22] / 255,
                        dist = instr.i[23] * 1e-5,
                        drive = instr.i[24] / 32,
                        panAmt = instr.i[25] / 512,
                        panFreq = 6.283184 * (2 ** (instr.i[26] - 9)) / rowLen,
                        dlyAmt = instr.i[27] / 255,
                        dly = instr.i[28] * rowLen & ~1;  // Must be an even number

                    // Calculate start sample number for this row in the pattern
                    rowStartSample = (p * patternLen + row) * rowLen;

                    // Generate notes for this pattern row
                    for (col = 0; col < 4; ++col) {
                        n = cp ? instr.c[cp - 1].n[row + col * patternLen] : 0;
                        if (n) {
                            if (!noteCache[n]) {
                                noteCache[n] = createNote(instr, n, rowLen);
                            }

                            // Copy note from the note cache
                            var noteBuf = noteCache[n];
                            for (j = 0, i = rowStartSample * 2; j < noteBuf.length; j++, i += 2) {
                              chnBuf[i] += noteBuf[j];
                            }
                        }
                    }

                    // Perform effects for this pattern row
                    for (j = 0; j < rowLen; j++) {
                        // Dry mono-sample
                        k = (rowStartSample + j) * 2;
                        rsample = chnBuf[k];

                        // We only do effects if we have some sound input
                        if (rsample || filterActive) {
                            // State variable filter
                            f = fxFreq;
                            if (fxLFO) {
                                f *= oscLFO(lfoFreq * k) * lfoAmt + 0.5;
                            }
                            f = 1.5 * Math.sin(f);
                            low += f * band;
                            high = q * (rsample - band) - low;
                            band += f * high;
                            rsample = fxFilter == 3 ? band : fxFilter == 1 ? high : low;

                            // Distortion
                            if (dist) {
                                rsample *= dist;
                                rsample = rsample < 1 ? rsample > -1 ? osc_sin(rsample*.25) : -1 : 1;
                                rsample /= dist;
                            }

                            // Drive
                            rsample *= drive;

                            // Is the filter active (i.e. still audiable)?
                            filterActive = rsample * rsample > 1e-5;

                            // Panning
                            t = Math.sin(panFreq * k) * panAmt + 0.5;
                            lsample = rsample * (1 - t);
                            rsample *= t;
                        } else {
                            lsample = 0;
                        }

                        // Delay is always done, since it does not need sound input
                        if (k >= dly) {
                            // Left channel = left + right[-p] * t
                            lsample += chnBuf[k-dly+1] * dlyAmt;

                            // Right channel = right + left[-p] * t
                            rsample += chnBuf[k-dly] * dlyAmt;
                        }

                        // Store in stereo channel buffer (needed for the delay effect)
                        chnBuf[k] = lsample | 0;
                        chnBuf[k+1] = rsample | 0;

                        // ...and add to stereo mix buffer
                        mMixBuf[k] += lsample | 0;
                        mMixBuf[k+1] += rsample | 0;

                        // ...and channel
                        mChannelBufs[mCurrentCol][k] += lsample | 0;
                        mChannelBufs[mCurrentCol][k+1] += rsample | 0;
                    }
                }
            }

            // Next iteration. Return progress (1.0 == done!).
            mCurrentCol++;
            return mCurrentCol / mSong.numChannels;
        };

        // Create a AudioBuffer from the generated audio data
        this.createAudioBuffer = function(context, channelNumber) {
            let source = channelNumber === undefined ? mMixBuf : mChannelBufs[channelNumber];

            var buffer = context.createBuffer(2, mNumWords / 2, 44100);
            for (var i = 0; i < 2; i ++) {
                var data = buffer.getChannelData(i);
                for (var j = i; j < mNumWords; j += 2) {
                    data[j >> 1] = source[j] / 65536;
                }
            }

            return buffer;
        };

        // Create a WAVE formatted Uint8Array from the generated audio data
        this.createWave = function() {
            // Create WAVE header
            var headerLen = 44;
            var l1 = headerLen + mNumWords * 2 - 8;
            var l2 = l1 - 36;
            var wave = new Uint8Array(headerLen + mNumWords * 2);
            wave.set(
                [82,73,70,70,
                 l1 & 255,(l1 >> 8) & 255,(l1 >> 16) & 255,(l1 >> 24) & 255,
                 87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,
                 68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,
                 l2 & 255,(l2 >> 8) & 255,(l2 >> 16) & 255,(l2 >> 24) & 255]
            );

            // Append actual wave data
            for (var i = 0, idx = headerLen; i < mNumWords; ++i) {
                // Note: We clamp here
                var y = mMixBuf[i];
                y = y < -32767 ? -32767 : (y > 32767 ? 32767 : y);
                wave[idx++] = y & 255;
                wave[idx++] = (y >> 8) & 255;
            }

            // Return the WAVE formatted typed array
            return wave;
        };

        // Get n samples of wave data at time t [s]. Wave data in range [-2,2].
        this.getData = function(t, n) {
            var i = 2 * Math.floor(t * 44100);
            var d = new Array(n);
            for (var j = 0; j < 2*n; j += 1) {
                var k = i + j;
                d[j] = t > 0 && k < mMixBuf.length ? mMixBuf[k] / 32768 : 0;
            }
            return d;
        };
    };

    // Song: ThirteenthCenturyVibes

        // This music has been exported by SoundBox. You can use it with
        // http://sb.bitsnbites.eu/player-small.js in your own product.

        // See http://sb.bitsnbites.eu/demo.html for an example of how to
        // use it in a demo.

        // Song data
        const song = {
          songData: [
            { // Instrument 0
              i: [
              1, // OSC1_WAVEFORM
              192, // OSC1_VOL
              128, // OSC1_SEMI
              0, // OSC1_XENV
              1, // OSC2_WAVEFORM
              191, // OSC2_VOL
              116, // OSC2_SEMI
              9, // OSC2_DETUNE
              0, // OSC2_XENV
              0, // NOISE_VOL
              6, // ENV_ATTACK
              22, // ENV_SUSTAIN
              34, // ENV_RELEASE
              0, // ENV_EXP_DECAY
              0, // ARP_CHORD
              0, // ARP_SPEED
              0, // LFO_WAVEFORM
              69, // LFO_AMT
              3, // LFO_FREQ
              1, // LFO_FX_FREQ
              1, // FX_FILTER
              23, // FX_FREQ
              167, // FX_RESONANCE
              0, // FX_DIST
              32, // FX_DRIVE
              77, // FX_PAN_AMT
              6, // FX_PAN_FREQ
              7, // FX_DELAY_AMT
              6 // FX_DELAY_TIME
              ],
              // Patterns
              p: [,,2,2,2,2,1,1,1,3,1,1,1,3],
              // Columns
              c: [
                {n: [125,137,125,,,,125,,130,,130,,125,,,,125,125,125,,,,125,,130,,130,,125,,,,128,,128,140,,,128,,134,,134,,,128,,,128,,128,128,,,128,,134,,134,,,128,,,132,,132,,134,,132,,125,,125,,,,130,,132,,132,,134,,132,,125,,125,,,135,130,,,,,134,,,,,,,,,,,,132,,,,134,,,,,,142,,144,,,,132],
                 f: []},
                {n: [125,,125,,,,125,,130,,130,,125,,,,125,,125,,,,125,,130,,130,,125,,,,128,,128,,,,128,,134,,134,,,,,,128,,128,128,,,128,,134,,134,,,128,,,132,,132,,134,,132,,125,,125,,,,,,132,,132,,134,,132,,125,,125,,,,130,,,,,,,,,,,,,,,,,,,,,,,,,,,,,144],
                 f: []},
                {n: [125,137,125,,,,125,,130,,130,,125,,,,144,,144,,142,,142,,140,,140,,137,,137,,128,,128,140,,,128,,134,,134,,,128,,,,132,,132,,130,,130,,128,,128,,125,,125,132,,132,,134,,132,,125,,125,,,,130,,,,,,,,,,,,,,,,,,,,,134,,,,,,,,,,,,132],
                 f: []}
              ]
            },
            { // Instrument 1
              i: [
              3, // OSC1_WAVEFORM
              100, // OSC1_VOL
              128, // OSC1_SEMI
              0, // OSC1_XENV
              3, // OSC2_WAVEFORM
              201, // OSC2_VOL
              128, // OSC2_SEMI
              2, // OSC2_DETUNE
              0, // OSC2_XENV
              0, // NOISE_VOL
              0, // ENV_ATTACK
              6, // ENV_SUSTAIN
              49, // ENV_RELEASE
              0, // ENV_EXP_DECAY
              0, // ARP_CHORD
              0, // ARP_SPEED
              0, // LFO_WAVEFORM
              139, // LFO_AMT
              4, // LFO_FREQ
              1, // LFO_FX_FREQ
              3, // FX_FILTER
              30, // FX_FREQ
              184, // FX_RESONANCE
              119, // FX_DIST
              244, // FX_DRIVE
              147, // FX_PAN_AMT
              6, // FX_PAN_FREQ
              24, // FX_DELAY_AMT
              6 // FX_DELAY_TIME
              ],
              // Patterns
              p: [2,3,2,2,2,2,2,2,2,3,2,2,2,3],
              // Columns
              c: [
                {n: [],
                 f: []},
                {n: [113,,113,,113,,113,,118,,118,,118,,118,,113,,113,,113,,113,,118,,118,,118,,118],
                 f: []},
                {n: [113,,113,,113,,113,,118,,118,,118,,118,,113,,111,,113,,115,,116,,118,,120,,122],
                 f: []}
              ]
            },
            { // Instrument 2
              i: [
              0, // OSC1_WAVEFORM
              0, // OSC1_VOL
              128, // OSC1_SEMI
              0, // OSC1_XENV
              0, // OSC2_WAVEFORM
              0, // OSC2_VOL
              128, // OSC2_SEMI
              0, // OSC2_DETUNE
              0, // OSC2_XENV
              125, // NOISE_VOL
              0, // ENV_ATTACK
              1, // ENV_SUSTAIN
              59, // ENV_RELEASE
              0, // ENV_EXP_DECAY
              0, // ARP_CHORD
              0, // ARP_SPEED
              0, // LFO_WAVEFORM
              0, // LFO_AMT
              0, // LFO_FREQ
              0, // LFO_FX_FREQ
              1, // FX_FILTER
              193, // FX_FREQ
              171, // FX_RESONANCE
              0, // FX_DIST
              29, // FX_DRIVE
              39, // FX_PAN_AMT
              3, // FX_PAN_FREQ
              88, // FX_DELAY_AMT
              3 // FX_DELAY_TIME
              ],
              // Patterns
              p: [,,,,,,4,4,4,5,4,4,4,5],
              // Columns
              c: [
                {n: [],
                 f: []},
                {n: [],
                 f: []},
                {n: [],
                 f: []},
                {n: [113,,,,,,,,113,,,,,,,,113,,,,,,,,113],
                 f: []},
                {n: [113,,,,,,,,113,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,113,,,,113,,,,113,,,,113,113,113],
                 f: []}
              ]
            },
            { // Instrument 3
              i: [
              0, // OSC1_WAVEFORM
              160, // OSC1_VOL
              128, // OSC1_SEMI
              64, // OSC1_XENV
              0, // OSC2_WAVEFORM
              160, // OSC2_VOL
              128, // OSC2_SEMI
              0, // OSC2_DETUNE
              64, // OSC2_XENV
              210, // NOISE_VOL
              4, // ENV_ATTACK
              7, // ENV_SUSTAIN
              52, // ENV_RELEASE
              85, // ENV_EXP_DECAY
              0, // ARP_CHORD
              0, // ARP_SPEED
              0, // LFO_WAVEFORM
              60, // LFO_AMT
              4, // LFO_FREQ
              1, // LFO_FX_FREQ
              2, // FX_FILTER
              255, // FX_FREQ
              0, // FX_RESONANCE
              0, // FX_DIST
              32, // FX_DRIVE
              61, // FX_PAN_AMT
              5, // FX_PAN_FREQ
              32, // FX_DELAY_AMT
              6 // FX_DELAY_TIME
              ],
              // Patterns
              p: [4,4,4,5,4,5,4,4,4,5,4,4,4,5],
              // Columns
              c: [
                {n: [],
                 f: []},
                {n: [],
                 f: []},
                {n: [],
                 f: []},
                {n: [,,,,113,,,,,,,,113,,,,,,,,113,,,,,,,,113],
                 f: []},
                {n: [,,,,113,,,,,,,,113,,,,113,,,,113,,,,113,,,,113],
                 f: []}
              ]
            },
            { // Instrument 4
              i: [
              0, // OSC1_WAVEFORM
              0, // OSC1_VOL
              140, // OSC1_SEMI
              0, // OSC1_XENV
              0, // OSC2_WAVEFORM
              0, // OSC2_VOL
              140, // OSC2_SEMI
              0, // OSC2_DETUNE
              0, // OSC2_XENV
              81, // NOISE_VOL
              4, // ENV_ATTACK
              10, // ENV_SUSTAIN
              47, // ENV_RELEASE
              55, // ENV_EXP_DECAY
              0, // ARP_CHORD
              0, // ARP_SPEED
              0, // LFO_WAVEFORM
              187, // LFO_AMT
              5, // LFO_FREQ
              0, // LFO_FX_FREQ
              1, // FX_FILTER
              239, // FX_FREQ
              135, // FX_RESONANCE
              0, // FX_DIST
              32, // FX_DRIVE
              108, // FX_PAN_AMT
              5, // FX_PAN_FREQ
              16, // FX_DELAY_AMT
              4 // FX_DELAY_TIME
              ],
              // Patterns
              p: [,4,4,5,4,5,4,4,4,5,4,4,4,5],
              // Columns
              c: [
                {n: [],
                 f: []},
                {n: [],
                 f: []},
                {n: [],
                 f: []},
                {n: [,113,113,,,113,,,,113,113,,,113,,,,113,113,,,113,,,,113,113,,,113],
                 f: []},
                {n: [,113,113,,,113,,,,113,113,,,113,,,113,,113,,113,,113,,113,,113,,113,,113,,,,,,,,,,,,,,,,,,,,,,,,,,,113,,,,113],
                 f: []}
              ]
            },
          ],
          rowLen: 5513,   // In sample lengths
          patternLen: 32,  // Rows per pattern
          endPattern: 13,  // End pattern
          numChannels: 5  // Number of channels
        };

    // Audio

    const TRACK_COMBAT = 5;
    const TRACK_WAVE = 6;

    const Audio = {
        init() {
            Audio.contextCreated = false;
            Audio.readyToPlay = false;
            Audio.musicEnabled = true;
            Audio.sfxEnabled = true;
            Audio.musicVolume = 0;
            Audio.sfxVolume = 0;

            Audio.playerJump = [,,315,,.08,.07,,.77,-16,,,,,,,,,.91,.01];
            Audio.playerLand = [1.33,,423,.01,,.06,2,2.64,-3.8,,,,,.1,,.2,,.54,.01]; // Hit 491
            Audio.playerDeath = [1.11,,779,.01,.2,.48,4,4.56,.4,,,,.02,.9,,1,,.34,.13]; // Explosion 566
            Audio.playerSlam = [2.05,,374,.01,.05,.02,2,.59,-8.2,,,,,,,.5,.29,.65,.09]; // Shoot 673

            Audio.littleJump = [1.01,,491,,.01,.05,,1.02,25,,,,,,,.1,,.45,.08]; // Jump 438
            Audio.littleEscape = [,,433,.01,.18,.24,,.51,,,418,,.06,.1,,,,.43,.25,.11]; // Powerup 426

            Audio.enemyDeath = [1.81,,135,.01,.04,.18,1,.11,-6.6,,,,,.2,,.3,.15,.74,.09]; // Hit 569

            Audio.towerShoot = [1.01,,1250,.01,.09,.14,,1.77,-6.3,,,,,,23,,,.46,.02];
            Audio.mothDeath = [1.04,,363,.01,.08,.52,2,.31,.3,,,,,1.5,,.9,,.34,.07];
            Audio.ghostDeath = [2.01,,332,.02,.05,.16,1,.53,-0.8,,-7,.01,,.1,,,.03,.48,.04];
            Audio.buildingFinished = [2.03,0,65.40639,.03,.66,.18,2,.95,,,,,.3,.4,,,.19,.21,.1,.04];
            Audio.waveCountdown = [1.56,0,261.6256,,.13,.3,,.41,,,,,,.2,,,.05,.2,.19,.22];
            Audio.tile = [1.68,,0,.01,.01,0,,1.83,-28,-7,,,,,,,.02,,.01];
        },

        initContext() {
            if (Audio.contextCreated) return;

            // In Safari, ensure our target AudioContext is created inside a
            // click or tap event (this ensures we don't interact with it until
            // after user input).
            //
            // Chrome and Firefox are more relaxed, but this approach works for all 3.
            ZZFX.x = Audio.ctx = new AudioContext();
            Audio.gain_ = Audio.ctx.createGain();
            Audio.gain_.connect(Audio.ctx.destination);
            ZZFX.destination = Audio.gain_;

            Audio.contextCreated = true;
        },

        initTracks() {
            // In this game, we ensure the screen that calls this function happens after the
            // user has interacted at least once (and that interaction called initContext above),
            // so we know it's safe to interact with the audio context.
            if (!Audio.musicPlaying) {
                this.player = new CPlayer();
                this.player.init(song);

                for (;;) {
                    if (this.player.generate() === 1) break;
                }

                this.musicGainNodes = [];
                this.songSources = [];

                for (let i = 0; i < song.numChannels; i++) {
                    let buffer = this.player.createAudioBuffer(Audio.ctx, i);
                    this.songSource = Audio.ctx.createBufferSource();

                    let gainNode = Audio.ctx.createGain();
                    gainNode.connect(Audio.gain_);
                    this.musicGainNodes.push(gainNode);

                    /*if (i === TRACK_COMBAT || i === TRACK_WAVE) {
                        gainNode.gain.value = 0;
                    }*/

                    this.songSource.buffer = buffer;
                    this.songSource.loop = true;
                    this.songSource.connect(gainNode);
                    this.songSources.push(this.songSource);
                }

                this.musicStartTime = Audio.ctx.currentTime + 0.1;

                for (let i = 0; i < song.numChannels; i++) {
                    this.songSources[i].start(this.musicStartTime);
                    // comment out music
                }

                Audio.musicPlaying = true;
            }

            Audio.readyToPlay = true;
        },

        update() {
            if (!Audio.readyToPlay) return;

            this.sfxVolume = this.sfxEnabled ? 0.3 : 0;
            this.musicVolume = this.musicEnabled ? 1 : 0;

            ZZFX.volume = this.sfxVolume;

            if (this.sfxEnabled) {
                ZZFX.volume = 0.3;
            } else {
                ZZFX.volume = 0;
            }
        },

        play(sound) {
            if (!Audio.readyToPlay) return;
            ZZFX.play(...sound);
        },

        startWave() {
            if (!Audio.musicPlaying) return;

            if (!this.trackWavePlaying) {
                let sequenceLength = song.rowLen * 4 / 44100;
                let intoPattern = (Audio.ctx.currentTime - this.musicStartTime) % sequenceLength;
                let startTime = Audio.ctx.currentTime - intoPattern + sequenceLength;

                //this.musicGainNodes[TRACK_WAVE].gain.linearRampToValueAtTime(1, Audio.ctx.currentTime + 3);
                this.musicGainNodes[TRACK_WAVE].gain.setValueAtTime(1, startTime);
                this.trackWavePlaying = true;
            }
        },

        stopWave() {
            if (!Audio.musicPlaying) return;

            if (this.trackWavePlaying) {
                this.musicGainNodes[TRACK_WAVE].gain.linearRampToValueAtTime(0, Audio.ctx.currentTime + 4);
                this.trackWavePlaying = false;
            }
        },

        startCombat() {
            if (!Audio.musicPlaying) return;

            if (!this.trackCombatPlaying) {
                let sequenceLength = song.rowLen * 4 / 44100;
                let intoPattern = (Audio.ctx.currentTime - this.musicStartTime) % sequenceLength;
                let startTime = Audio.ctx.currentTime - intoPattern + sequenceLength;

                //this.musicGainNodes[TRACK_COMBAT].gain.linearRampToValueAtTime(1, Audio.ctx.currentTime + 1);
                this.musicGainNodes[TRACK_COMBAT].gain.setValueAtTime(1, startTime);
                this.trackCombatPlaying = true;
            }
        },

        stopCombat() {
            if (!Audio.musicPlaying) return;

            if (this.trackCombatPlaying) {
                this.musicGainNodes[TRACK_COMBAT].gain.linearRampToValueAtTime(0, Audio.ctx.currentTime + 4);
                this.trackCombatPlaying = false;
            }
        },

        // It's important we do pausing and unpausing as specific events and not in general update(),
        // because update() is triggered by the animation frame trigger which does not run if the
        // page is not visible. (So, if you want the music to fade in the background, for example,
        // that's not helpful if it won't work because you aren't looking at the page!)

        pause() {
            if (Audio.readyToPlay) {
                Audio.gain_.gain.linearRampToValueAtTime(0, Audio.ctx.currentTime + 1);
            }
        },

        unpause() {
            if (Audio.readyToPlay) {
                Audio.gain_.gain.linearRampToValueAtTime(1, Audio.ctx.currentTime + 1);
            }
        }
    };

    // KeyboardAdapter

    const KeyboardAdapter = {
        init() {
            KeyboardAdapter.map = {
                KeyW:        Input.Action.UP,
                KeyA:        Input.Action.LEFT,
                KeyS:        Input.Action.DOWN,
                KeyD:        Input.Action.RIGHT,
                Space:       Input.Action.JUMP,
                Enter:       Input.Action.CONTINUE,
                ArrowUp:     Input.Action.UP,
                ArrowLeft:   Input.Action.LEFT,
                ArrowDown:   Input.Action.DOWN,
                ArrowRight:  Input.Action.RIGHT,
                Escape:      Input.Action.MENU
            };

            // For keyboard, we support 8-point movement (S, E, SE, etc.)
            KeyboardAdapter.arrowDirections = [
                { x:   R0, y:   R0, m: 0 },
                { x:   R0, y: -R90, m: 1 },
                { x:   R0, y:  R90, m: 1 },
                { x:   R0, y:   R0, m: 0 },
                { x: -R90, y:   R0, m: 1 },
                { x: -R45, y: -R45, m: 1 },
                { x: -R45, y:  R45, m: 1 },
                { x: -R90, y:   R0, m: 1 },
                { x:  R90, y:   R0, m: 1 },
                { x:  R45, y: -R45, m: 1 },
                { x:  R45, y:  R45, m: 1 },
                { x:  R90, y:   R0, m: 1 },
                { x:   R0, y:   R0, m: 0 },
                { x:   R0, y: -R90, m: 1 },
                { x:   R0, y:  R90, m: 1 },
                { x:   R0, y:   R0, m: 0 }
            ];

            KeyboardAdapter.held = [];

            window.addEventListener('keydown', event => {
                let k = KeyboardAdapter.map[event.code];
                // Debugging - key presses
                 console.log(event.key, event.keyCode, event.code, k);
                             // Hack to ensure we initialize audio after user interacts with game
                Audio.initContext();
                if (k) {
                    KeyboardAdapter.held[k] = true;
                }
            });

            window.addEventListener('keyup', event => {
                let k = KeyboardAdapter.map[event.code];
                if (k) {
                    KeyboardAdapter.held[k] = false;
                }

                if (event.key >= '1' && event.key <= '9') {
                    game.nextLevel = Number(event.key) - 1;
                    game.screens.pop();
                }
            });

            KeyboardAdapter.reset();
        },

        update() {
            // For keyboards, we want to convert the state of the various arrow keys being held down
            // into a directional vector. We use the browser's event to handle the held state of
            // the other action buttons, so we don't need to process them here.
            let state =
                (KeyboardAdapter.held[Input.Action.UP] ? 1 : 0) +
                (KeyboardAdapter.held[Input.Action.DOWN] ? 2 : 0) +
                (KeyboardAdapter.held[Input.Action.LEFT] ? 4 : 0) +
                (KeyboardAdapter.held[Input.Action.RIGHT] ? 8 : 0);

            KeyboardAdapter.direction = KeyboardAdapter.arrowDirections[state];
        },

        reset() {
            KeyboardAdapter.direction = KeyboardAdapter.arrowDirections[0];
            for (let action of Object.values(Input.Action)) {
                KeyboardAdapter.held[action] = false;
            }
        }
    };

    // MouseAdapter

    const MouseAdapter = {
        init() {
            this.map = [];
            this.map[0] = Input.Action.RAW_TOUCH; // LMB
            this.map[2] = Input.Action.RELOAD; // RMB

            this.held = [];

            window.addEventListener('mousemove', event => {
                if (!this.pointer) this.pointer = {};
                this.pointer.u = ((event.clientX * Viewport.width) / Viewport.clientWidth) | 0;
                this.pointer.v = ((event.clientY * Viewport.height) / Viewport.clientHeight) | 0;
                Input.mode = INPUT_MODE_MOUSE;
            });

            window.addEventListener('mouseout', () => {
                this.pointer = undefined;
            });

            window.addEventListener('mousedown', event => {
                let k = this.map[event.button];
                if (k) this.held[k] = true;

                // Hack to ensure we initialize audio after user interacts with game
                Audio.initContext();
                Input.mode = INPUT_MODE_MOUSE;

                this.pointerDragStart = {
                    u: ((event.clientX * Viewport.width) / Viewport.clientWidth) | 0,
                    v: ((event.clientY * Viewport.height) / Viewport.clientHeight) | 0
                };
            });

            window.addEventListener('mouseup', event => {
                let k = this.map[event.button];
                if (k) this.held[k] = false;
                Input.mode = INPUT_MODE_MOUSE;
            });

            window.addEventListener('click', event => {
                event.preventDefault();
                game.frogger = 'click';
            });

            window.addEventListener('contextmenu', event => {
                let k = this.map[event.button];
                if (k) this.held[k] = true;
                this.releaseRMBTick = 2;
                event.preventDefault();
            });

            MouseAdapter.reset();
        },

        update() {
            // Hacks: ideally we could use mousedown and mouseup for all clicks and preventDefault to
            // avoid opening the browser's context menu. This hasn't worked for me so far when clicking
            // on a canvas, so I need to use the context menu event to capture a right mouse click instead.
            //
            // We fake a down/up for RMB clicks, which means we can't determine how long the RMB is held
            // (but luckily we don't need to for this game).
            if (this.releaseRMBTick) {
                this.releaseRMBTick--;
                if (this.releaseRMBTick === 0) {
                    this.held[Input.Action.RELOAD] = false;
                }
            }
        },

        reset() {
            this.pointer = undefined;
            for (let action of Object.values(Input.Action)) {
                this.held[action] = false;
            }
        }
    };

    // TouchAdapter

    const TouchAdapter = {
        init() {
            this.map = [];
            this.map[0] = Input.Action.RAW_TOUCH;

            this.held = [];

            window.addEventListener('touchmove', event => {
                if (!this.pointer) this.pointer = {};
                let p = event.changedTouches[0];
                this.pointer.u = ((p.clientX * Viewport.width) / Viewport.clientWidth) | 0;
                this.pointer.v = ((p.clientY * Viewport.height) / Viewport.clientHeight) | 0;
                Input.mode = INPUT_MODE_TOUCH;
            });

            window.addEventListener('touchstart', event => {
                let k = this.map[0];
                if (k) this.held[k] = true;

                // Hack to ensure we initialize audio after user interacts with game
                Audio.initContext();
                Input.mode = INPUT_MODE_TOUCH;

                let p = event.changedTouches[0];
                this.pointerDragStart = {
                    u: ((p.clientX * Viewport.width) / Viewport.clientWidth) | 0,
                    v: ((p.clientY * Viewport.height) / Viewport.clientHeight) | 0
                };
                this.pointer = { ...this.pointerDragStart };
            });

            window.addEventListener('touchend', event => {
                let k = this.map[0];
                if (k) this.held[k] = false;
                game.frogger = 'TOUCHEND';
                Input.mode = INPUT_MODE_TOUCH;
            });

            this.reset();
        },

        update() {
        },

        reset() {
            this.pointer = undefined;
            for (let action of Object.values(Input.Action)) {
                this.held[action] = false;
            }
        }
    };

    // Input

    const Input = {
        // Game Inputs
        //
        // Note that moving the player around is actually not considered an action; it's
        // a separate non-action input called "direction". It just so happens that on
        // keyboard, for example, pressing the "down arrow" key is considered both a
        // press of the in-game DOWN action and a directional input. It's up to the input
        // consumer to decide which input is relevant (if any). For example, on a menu,
        // we may consume the DOWN/UP actions to navigate the menu, but ignore directional
        // inputs.
        //
        Action: {
            UP: 11,
            DOWN: 12,
            LEFT: 13,
            RIGHT: 14,
            JUMP: 22,
            ATTACK: 21,
            RELOAD: 30,
            CONTINUE: 95,
            MENU: 96,
            MUSIC_TOGGLE: 97,
            SFX_TOGGLE: 98,
            RAW_TOUCH: 40,
            DRAG: 41,
            TAP: 42
        },

        init() {
            // A vector representing the direction the user is pressing/facing,
            // separate from pressing and releasing inputs. Treating "direction"
            // separately makes it easier to handle gamepad sticks.
            this.direction = { x: 0, y: 0, m: 0 };

            // "Pressed" means an input was pressed THIS FRAME.
            this.pressed = {};

            // "Released" means an input was released THIS FRAME.
            this.released = {};

            // "Held" means an input is held down. The input was "Pressed" either
            // this frame or in a past frame, and has not been "Released" yet.
            this.held = {};

            // How many frames was this input held down by the player. If [held]
            // is false, it represents how long the input was last held down.
            this.framesHeld = {};

            KeyboardAdapter.init();
            MouseAdapter.init();
            TouchAdapter.init();

            this.mode = INPUT_MODE_TOUCH;

            this.dragging = false;
        },

        update() {
            // We could have some kind of "input adapter toggle", but it's easier to just treat all inputs
            // as valid -- if you're pressing the "attack" button on either gamepad or keyboard, then you're
            // attacking. For directional input, we instead check whether there's movement on the thumbstick,
            // and we use it if there is -- otherwise we try to extract movement from the keyboard instead.

            KeyboardAdapter.update();

            let pointerAdapter = this.mode === INPUT_MODE_MOUSE ? MouseAdapter : TouchAdapter;

            for (let action of Object.values(Input.Action)) {
                let held = pointerAdapter.held[action] || KeyboardAdapter.held[action];
                this.pressed[action] = !this.held[action] && held;
                this.released[action] = this.held[action] && !held;

                if (this.pressed[action]) {
                    this.framesHeld[action] = 1;
                } else if (this.held[action] && held) {
                    this.framesHeld[action]++;
                }

                this.held[action] = held;
            }

            this.pointer = pointerAdapter.pointer;
            this.direction = KeyboardAdapter.direction;
            //this.direction = this.gamepad.direction.m > 0 ? this.gamepad.direction : this.keyboard.direction;

            if (this.held[Input.Action.RAW_TOUCH]) {
                if (this.framesHeld[Input.Action.RAW_TOUCH] > 20) {
                    this.dragging = true;
                }

                let diffPixels = Math.abs(pointerAdapter.pointerDragStart.u - pointerAdapter.pointer.u) + Math.abs(pointerAdapter.pointerDragStart.v - pointerAdapter.pointer.v);
                if (diffPixels > 5) {
                    this.dragging = true;
                }
            }

            if (this.dragging && pointerAdapter.pointer) {
                this.dragVector = {
                    x: pointerAdapter.pointer.u - pointerAdapter.pointerDragStart.u,
                    y: pointerAdapter.pointer.v - pointerAdapter.pointerDragStart.v
                };
            }

            if (this.released[Input.Action.RAW_TOUCH]) {
                if (this.dragging) {
                    this.dragging = false;
                } else {
                    this.pressed[Input.Action.TAP] = true;
                    this.framesHeld[Input.Action.TAP] = 1;
                }
            }
        },

        onDown(action) {},
        onUp(action) {},
    };

    // Camera

    const Camera = {
        init() {
            this.pos = { x: 0, y: 0 };
            this.forceTarget = undefined;
            this.vel = { x: 0, y: 0 };
        },

        update() {
            if (this.forceTarget) {
                this.pos = this.forceTarget;

                /*
                let dist = vectorBetween(this.pos, this.forceTarget);

                if (dist.m < 1) {
                    this.forceTarget = undefined;
                    return;
                }

                dist.m = clamp(dist.m, 0, 2);

                let newVelocity = vector2point(dist);
                this.vel = {
                    x: (this.vel.x * 2 + newVelocity.x) / 3,
                    y: (this.vel.y * 2 + newVelocity.y) / 3
                };

                this.pos.x += this.vel.x;
                this.pos.y += this.vel.y;

                */
            }

            if (Input.pressed[Input.Action.RAW_TOUCH]) {
                this.dragStart = { ...this.pos };
            }

            if (Input.dragging) {
                this.pos = {
                    x: this.dragStart.x - Input.dragVector.x,
                    y: this.dragStart.y - Input.dragVector.y
                };
            }

            //this.pos = Game.player.pos;
            //this.pos = { x: 0, y: 0, z: 0 };
        }
    };

    function normalizeVector(p) {
        let m = Math.sqrt(p.x * p.x + p.y * p.y);
        return m === 0 ? { x: 0, y: 0, m: 0 } : { x: p.x / m, y: p.y / m, m };
    }

    function vectorBetween(p1, p2) {
        return normalizeVector({ x: p2.x - p1.x, y: p2.y - p1.y });
    }

    function angle2vector(r, m) {
        return { x: Math.cos(r), y: Math.sin(r), m: m || 1 };
    }

    function vector2point(v) {
        return { x: v.x * (v.m || 1), y: v.y * (v.m || 1) };
    }

    function xy2qr(pos) {
        return { q: (pos.x / TILE_SIZE) | 0, r: (pos.y / TILE_SIZE) | 0 };
    }

    function qr2xy(pos) {
        return { x: pos.q * TILE_SIZE, y: pos.r * TILE_SIZE };
    }

    function xy2uv(pos) {
        return {
            u: pos.x + Viewport.center.u - Camera.pos.x,
            v: pos.y + Viewport.center.v - Camera.pos.y
        };
    }

    function uv2xy(pos) {
        return {
            x: pos.u - Viewport.center.u + Camera.pos.x,
            y: pos.v - Viewport.center.v + Camera.pos.y
        };
    }

    function centerxy(pos) {
        return {
            x: pos.x + TILE_SIZE / 2,
            y: pos.y + TILE_SIZE / 2
        };
    }

    function clamp(value, min, max) {
        return value < min ? min : value > max ? max : value;
    }

    function manhattanXY(xy1, xy2) {
        return Math.abs(xy1.x - xy2.x) + Math.abs(xy1.y - xy2.y);
    }

    /**
     * @param {XY[]} bounds  the upper-left and lower-right bounds
     * @yields {QR}
     */
    function* tilesHitInBounds(bounds) {
        for (let r = bounds[0].y / TILE_SIZE | 0; r * TILE_SIZE < bounds[1].y; r++) {
            for (let q = bounds[0].x / TILE_SIZE | 0; q * TILE_SIZE <  bounds[1].x; q++) {
                yield { q, r };
            }
        }
    }

    function rgba(r, g, b, a) {
        return `rgba(${r},${g},${b},${a})`;
    }

    function createCanvas(width, height) {
        let canvas = document.createElement('canvas');
        canvas.width = width;
        canvas.height = height;
        let ctx = canvas.getContext('2d');
        return { canvas, ctx };
    }

    function entityBB(entity) {
        return entity.bb.map(p => ({ x: p.x + entity.pos.x, y: p.y + entity.pos.y }));
    }

    function entityHBB(entity) {
        if (!entity.hbb) {
            return entityBB(entity);
        }
        return entity.hbb.map(p => ({ x: p.x + entity.pos.x, y: p.y + entity.pos.y }));
    }

    function entityABB(entity) {
        return entity.abb.map(p => ({ x: p.x + entity.pos.x, y: p.y + entity.pos.y }));
    }

    function isBoundingBoxOverlap(left, right) {
        return left[1].x >= right[0].x && right[1].x >= left[0].x &&
               left[1].y >= right[0].y && right[1].y >= left[0].y;
    }

    // SpriteSheet

    /**
     * This module is generated by `gulp buildAssets`.
     */
    const SpriteSheet =
        /* <generated> */
    { attack: [ [ 0, 0, 10, 10 ], [ 10, 0, 10, 10 ] ],
      bigarrow: [ [ 0, 10, 7, 13 ] ],
      bigpig:
       [ [ 0, 23, 15, 10 ],
         [ 15, 23, 15, 10 ],
         [ 30, 23, 15, 10 ],
         [ 45, 23, 15, 10 ],
         [ 60, 23, 15, 10 ],
         [ 75, 23, 15, 10 ] ],
      bleed:
       [ [ 0, 33, 9, 7 ],
         [ 9, 33, 9, 7 ],
         [ 18, 33, 9, 7 ],
         [ 27, 33, 9, 7 ],
         [ 36, 33, 9, 7 ],
         [ 45, 33, 9, 7 ],
         [ 54, 33, 9, 7 ],
         [ 63, 33, 9, 7 ] ],
      bleed2:
       [ [ 0, 40, 9, 7 ],
         [ 9, 40, 9, 7 ],
         [ 18, 40, 9, 7 ],
         [ 27, 40, 9, 7 ],
         [ 36, 40, 9, 7 ],
         [ 45, 40, 9, 7 ],
         [ 54, 40, 9, 7 ],
         [ 63, 40, 9, 7 ] ],
      bleed3: [ [ 0, 47, 1, 1 ] ],
      clouds: [ [ 0, 48, 28, 8 ], [ 28, 48, 28, 8 ], [ 56, 48, 28, 8 ], [ 84, 48, 28, 8 ] ],
      dirt: [ [ 0, 56, 1, 1 ], [ 1, 56, 1, 1 ] ],
      explosiona: [ [ 0, 57, 13, 13 ], [ 13, 57, 13, 13 ], [ 26, 57, 13, 13 ] ],
      explosionb:
       [ [ 0, 70, 21, 33 ],
         [ 21, 70, 21, 33 ],
         [ 42, 70, 21, 33 ],
         [ 63, 70, 21, 33 ],
         [ 84, 70, 21, 33 ] ],
      font: [ [ 0, 103, 180, 12 ] ],
      gore: [ [ 0, 115, 5, 5 ], [ 5, 115, 5, 5 ], [ 10, 115, 5, 5 ], [ 15, 115, 5, 5 ] ],
      knight: [ [ 0, 120, 7, 11 ], [ 7, 120, 7, 11 ], [ 14, 120, 7, 11 ] ],
      littlepig:
       [ [ 0, 131, 10, 7 ], [ 10, 131, 10, 7 ], [ 20, 131, 10, 7 ], [ 30, 131, 10, 7 ] ],
      littlepigbox:
       [ [ 0, 138, 15, 11 ], [ 15, 138, 15, 11 ], [ 30, 138, 15, 11 ], [ 45, 138, 15, 11 ] ],
      particle: [ [ 0, 149, 1, 1 ], [ 1, 149, 1, 1 ], [ 2, 149, 1, 1 ] ],
      sign: [ [ 0, 150, 10, 9 ] ],
      star2: [ [ 0, 159, 7, 6 ] ],
      tilebg: [ [ 0, 165, 10, 10 ] ],
      tiles:
       [ [ 0, 175, 8, 8 ],
         [ 8, 175, 8, 8 ],
         [ 16, 175, 8, 8 ],
         [ 24, 175, 8, 8 ],
         [ 32, 175, 8, 8 ],
         [ 40, 175, 8, 8 ],
         [ 48, 175, 8, 8 ],
         [ 56, 175, 8, 8 ],
         [ 64, 175, 8, 8 ],
         [ 72, 175, 8, 8 ],
         [ 80, 175, 8, 8 ],
         [ 88, 175, 8, 8 ],
         [ 96, 175, 8, 8 ],
         [ 104, 175, 8, 8 ] ],
      base64:
       'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC3CAYAAAC7WXScAAAAAXNSR0IArs4c6QAADuhJREFUeJztnW2IHdUZx/+z3byn3VBcIt5VVghspTd38yGhIt1QI1ITZPMhRUIbWgiI+WDaLNV8aUnWQPuhDWZrCk1qkVIojZKACemqFGKaFWtJPrjrWl8QXMxuQLeURCW4rjj9cD1zz5x73mbu3JeZ/f9gmZlznvMyc/7zzDPnzsxisrc3BCFFYrK3NzxWKjmF7WNDSNs5ViqFk729oY+w6dFJLqCoSREI5A1ZqBeWL8fI3FxQX6RmOzg/b8wnpB10yRsXli+P1rd9/rm14OD8fEBPTTqNmKBH5uYCWdSu0IOiJrkgSTwNMKYmOUEI29e22f0hJBPogUmuuLptb2jbJiQvdLlNCMkPkaCFV6Z3Jnkm5qEpZpJ3GHKQQkFBk0JBQZNCQUGTQkFBk0IR2GY2br/wDB8PJbkiAPTTdRQzySORaGVRU8ykEPCHFUII6SC0oUW5VNF66um5KWcowrL+ZUn2dMsbYnDuHaklHxzfFK1vB0LTQC2VsqqA07RLmkcA1A+sPDAq29+5AqDmgdpVVpRvZbvlUiUcXd+Nf/6wli+X/c2O13FwfBP6zh3CxoHhKJ3Cbh2xQdINrDpILwxsBlAb6HaUFeK6d6S7Le2Oru/Gd9aZTwIVUda7AElN5LHSDlI7ygJVUQJoeZ+B6vESQk9aljSX2OUbAFwDZbr0t7qsHMu2us+ifNqypHlEz3KoB10Mhrqus21H2em5qaBdfVZppCzJljqvIy7lox9+ETOU03XeylTOp7ypjqRlRDjhU9bWrhyWJO2zb1nSIsqlSqibWzWlZ5Wvs0lTJknZLOrIon2SHZHneO2W1XUH/+7/3rTmq3ZZ2Njy24F8DEjnk3iwXrtldegaZNlGZy9E62uj2sv5OrI8wUx5pDNJ/IB/0kHW2WddR9L1RvpCOpumvLHSKaI32fiIm0LPJ217BatVok9qQyHnm45+p7AZXpqQ3OMzc9JpsyskHZy2c0Cvny84bcdpu0LBaTuKtlBw2s5QB4WeTzhtBwq5SHDajpC8wWm7JQQHkhQJXqINhJ/OxE70YG0/j1UOcA6SOrBRQcsA68okEYQobyoj198MoaXZZ9IZJBKltgJpkF1lXIJwnQitEprcztjb8wCAA9/qbagdevzW4PSAKvIAR5Ws7Q98ToAkgh57ez7WRiP1JsHVhzRXGhOiLtcVifjj7V1V5MG2CVq1M9WXtH2ZRoWQpm2fNkW9aU5OevR0dAHmARXeWIePmIWdqMdkl9RDjb09H+tbIyeDrqxtv9O0KY6BqV51X+QTIU17Sxkvz9ooLi+t80Zp+pVFOGCrX81L4qWTYuoHPbWd4NiVyy0980c2b6kbEF0fRjZvSdw3Xd0+bdnqctln2WaSfhED5VIl/Hh8iJczQtIi4kT1csw4kbSdpOJ02VHUpBG6Js8fjQSkE+fk+aN127K9XJnPtnpTw7lYkiUBUBVp5Xs/qMucungacvrUxdMYfPAx7TwpoJ9DpUBJywk/nQmFJxZ/um3ZXl7q1k2hCCHNJDbfO3XxNABA9daypxZzxK4Hh9S5ZIYWpBXE3lhRwwtduixmnQcO1vYHpjhZzqfnJs0gUQwNNO9ZA5vXJ8SXQBWzTsSytwaAwQcfi8IONYRIc0NIMZOsiERoErKc1ujzzIQ0my5APz0HVGNn1TvLqDG0LXYmpCWI6TjT9JyaRkhusAmXoiaEENJ+fH7lTDqP3ow6CXEiRHd1216rAJP8rJ/kiUKKujE6+tt2LlzPlKStb3b4SJRmemVMtnHV6TP7w0cCiNabivU0dQHA1W17o7Lyumrr8uCEJEKISvzpBJ1EbCbxmtoVZSjqziKXIYfrkj87fCSy8RXb7Ree8brUB2v7A9l2dviI99vfFH7z6W5Ho614dkMIXog6yXMlQH0sq6vD9ySQ6+NzK82l5R5a9pxpXwQI1vYHfecOpW7f1TeTXRYeVneiNFonqdEyD63OIOhChiTeSzzp55pt6Dt3KOYdbR57dvgIbr/wTHB1GFbRZ+Vh6a2zxynoLJ6gSzLNJbdpeytGfVFAFW2aPogQQg0lxE3g7PAR9J07hKvb9oZJwg0TFHP2GAWtm5NV85r1bWb5sq+7RKteVo1PhY3wzqqYXXG1un+y1xZePOv9JtlQJ2ibkGXkGQSfr4r2nTsUeTi5DpGnpvmgzmTIQlUFL4taDkN06PIo4nwQE7Q66LIAdek2T6qrT72RU7fVehtB9dq68IQUj5igZU+miksVtg+m+mzeWm7LVqfPi7ZqeEIhF5+6kMMmFDUOFcJzXb7V+tR61DzfkMAlbtcnF0jx0M5DCwGoYYZY19naUOtT69TV64ssbt2JQDGTCPUhHPkZibQPAKn1ZVEvId5kLTAKlhBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIaSjCMOwqY93Nrv+pIQScpqab9tWl7YyrvZ0263Gtr+ufHX/fI6Hbmnqk6+9trPNoN2DpWISpMnOVs5m59OurZ5W4duvtPvvexyT9kvQ8k+BBUHQ0a9E6foXhmEo0oXgZbukg6i2J9cnthvdj0bQ9V89LrZxTLL/Pvk6e1P7dYLudMHpaKYA1IMXfIVoU2yb8kWavK2eIDr7Zu2PDzrxJj1Jbdtq+SQnh6k/gvoPzVjU34m4+uuzP74eRBWyy1YuY7JX8131twPdFUS9QumuWLp9SHoFch0/V3uE5BtdkG27vKTNV+vXtZvVUtcH0h7UsTBpJ4nGbHTpjOXLgnD3sk2afPmSJS+zRo1piZuk4kkaMqihmixYdazU8MLnBJBJNcuhNmrLTxozmeoT66YYLkn/SA2TQFxX1KRtqDfB6j2DwOTwfO9JunSFXejOKjXf5LF9sNmqVwT1AFDMyQgk1HTb0hfdFVyki/p0IYkpBDHVJ3B6aNcZ4dpB0Rmfu1S5Ptk+zUFs9KqwlDGJ27Ttqst1BVXXVT3obOm0CCGkMFyD+R/nyHnXN1TXH/8mwj095jKEtIIohlYFfLAH+LdG1P+b+GN4sKe6vqcH4dRCTdSE5A7VC+/pQUjvTArDnh6ElZUBxUw6gmjqo1yqRKKcnpuKTYmkzSOk1QRAVZR/PfnjKPFHj/wlEmfaPELaQrlUCf/08KPh5PmjYfjpTFguVcLJ80fDcqkSps1r9z6RpUvsl8Kpi6che9ws8ghpJd3Tc1PB2DjCA18lbNnZHwsd0uYR0g54U0gKRSzkePXpHqPhq0/34NWne2ICLpcqoUgnpBOIZiuAqmjvefgGgKq3td3gmfLppUk7iTy0ELPqbWUPrPPGIo1emnQC1uehp+emAuGxBfc8fCPywnK+nE5I2xHhgy6MsOXZ0glpNXUe1XfWol12hNiIfWimXKqE94504+D4JgDA9q8eH9VN1b0wsDnazsJOThPiprBJUrqBmoCEmPvOHcLGgWEIMW4HQnlWQ6RnZacKV35WhKImSQiEVwYQeWaV7e9cAVATqImkdi6xUtAkKd3Tc1MBjlXC0fXdwLp4piq87UCoE2taO5NgGXKQtHQDVeGMohKO4nWMfvgFAGB0fdVr60QlhCl4YWBzLG16bioQ8XIUZrxzRRtaCFGrIqaYScOoP2u7bFy2Is81refTLiE+WH/eTkKzPKrvg1HN7gfJB10AcGrXMoilWD+wYyv23daDAzu21uWJpbqeNeVSJZTb1aH2kyxt6n76vuOB1Ti1axnGxi8BAMbGL+HUrmW444HVLe2YEHOr2yX5Jibo3WcW8cGLNwFUPe+Jazci7/jBizex+8xiSzolxCy3y1CC+BAT9IEdWyPR7j6zGLvU7z6z2JLLuixm0S7FTHypCzn23dajFfO+25r/eCjFTBqlTtBymAHUPPWJazdU00yhmEkWxB5OEjeAAtlTn9q1DLvPXGpKJyhmkhUxDy3PKogwQ8TUYvYja9TZDIqZNEJdyCFmFcQNoLhRFLMfzYKzGSQL2v5LYSMP9vOXQqISlEuV8Nurv46hdV149PIExUByTewzBibo9UheCMqlSmibY564/iXevPkJRU1yQXRTOHR4J4YO78TKTYMYOrwzSiMkT8RmOSaeOIstO/sx8cRZDB3eiYknzrarX4SkIhL05bMzkUdeuWkQAD00yR9RDD1x/UujEWNokhc4y0EKRd0rTWLG48Q1fquO5A/txxpt4QchueHj8SG+cU1yTRRSyGL+xg7+BE7ySWDzyhQ2yRsBoA81KGaSRxhykELRBdTELITMm0OSV/jDCikWPm+s8AOKJC9Y/wsWIXmDgiaFgoImhYKCJoWCgiaFgoImhYKCJoWCP6yQQhHc/8v/WMX8s60j1gpmfuH+5p14YWBoXVdsXc4Xeery7r+N4eRvT+CRx/dF9vL2n3/yOyyUV2DF9EKsTZH2q2Pzzv41wtYv7Puvey6m/7sPhfs3bgAAjF66jNGtWwAAx994DzOvPBeo+TY+efMfdDYS3W6TxmhEzEPruvD8axci279L62JbJ2bBQnlF1rtTxwcv3jT+HxjbBy7vu/V9DN61DEBczAAw88pzwXHURD3x0C0AgMG7luHJl/tw363vR/VsOpzJbhQGp6BfmrJ7uAGscTaSVsy2V8GEuIWYZfGumF6Iidy1Dya+X+l1ln0EQcNfZpXFLBCiFttV8dfWJ99ajKWRKs6bwoFn10RL+U+kCdGZljYxi6VN1LMT7wKohhmzE+9G2/K6is4zq/02LWU7kfbRyVXa/I9OrsLFf5n/S5ctT4hRJ2aBSBe2dz71GY6/8R7ufOozitmAV8ghD7CKr4fViVmk2cqbYmex7eKlqfk6gfrs28Cza/AS5vHR9VV1eRPXvwROror6bxOuiSdf7gMAzLzya2cMLGyBWoxdSyMyqWNoIQSfsMEkZnVdt1yEPnZWWTG9kChm9hW26B+k/VX7nAYRQx9/46HQ5KHrbas3lHLaz/+QqvnC0vA8dDPFrIuhVTEvlFdEQhaxsxxX24TqYuDZNc7+2+J8n89B7N+4IRKpipw++dYi3v/pSuzfuAHP3/81zz1YejQ8y9FMMQ+t68LvlbBCjZtNnjma/cjoH9Ha+p/mOyZyDLx/4wYcR9xTi6m70UuX6+Jlxs9m/g85l+M9r5Zc+AAAAABJRU5ErkJggg==' };
    /* </generated> */

    /**
     * Sprite
     *
     * Encapsulates loading sprite slices from the spritesheet, organizing them, and
     * modifying them or constructing using primitives. To save space, we use some techniques
     * like storing only a small slice of an image in the spritesheet, then using code
     * to duplicate it, add some randomness, etc.
     */
    const Sprite = {
        // This is an exception to the rule, loading the spritesheet is a special action that
        // happens BEFORE everything is initialized.
        loadSpritesheet(cb) {
            let image = new Image();
            image.onload = cb;
            image.src = SpriteSheet.base64;
            Sprite.sheet = image;
        },

        init() {
            Sprite.attack = SpriteSheet.attack.map(initBasicSprite);

            Sprite.bigpig = [SpriteSheet.bigpig.map(initBasicSprite, { x: 7, y: 4 })];
            Sprite.bigpig.push(Sprite.bigpig[0].map(sprite => initDynamicSprite(flipHorizontal(sprite.img), sprite.anchor)));

            Sprite.littlepig = [SpriteSheet.littlepig.map(initBasicSprite)];
            Sprite.littlepig.push(Sprite.littlepig[0].map(sprite => initDynamicSprite(flipHorizontal(sprite.img), sprite.anchor)));

            Sprite.littlepigbox = SpriteSheet.littlepigbox.map(initBasicSprite, { x: 7, y: 5 });

            Sprite.explosiona = SpriteSheet.explosiona.map(initBasicSprite);
            Sprite.explosionb = SpriteSheet.explosionb.map(initBasicSprite);

            Sprite.particle = SpriteSheet.particle.map(initBasicSprite);

            Sprite.star2 = SpriteSheet.star2.map(initBasicSprite);

            Sprite.bleed = SpriteSheet.bleed.map(initBasicSprite, { x: 4, y: 0 });

            Sprite.knight = [SpriteSheet.knight.map(initBasicSprite, { x: 3, y: 6 })];
            Sprite.knight.push(Sprite.knight[0].map(sprite => initDynamicSprite(flipHorizontal(sprite.img), sprite.anchor)));

            Sprite.bigarrow = SpriteSheet.bigarrow.map(initBasicSprite);
            Sprite.dirt = SpriteSheet.dirt.map(initBasicSprite);

            Sprite.sign = SpriteSheet.sign.map(initBasicSprite);

            // Base pixel font and icons (see `Text.init` for additional variations)
            Sprite.font = initBasicSprite(SpriteSheet.font[0]);
            //Sprite.icon_mouse_lmb = initBasicSprite(SpriteSheet.icon_mouse[0]);
            //Sprite.icon_mouse_rmb = initBasicSprite(SpriteSheet.icon_mouse[1]);

            Sprite.clouds = SpriteSheet.clouds.map(initBasicSprite);

            // Enemies

            // Gore/blood
            Sprite.gore = SpriteSheet.gore.map(initBasicSprite);

            // Tiles
            Sprite.tiles = SpriteSheet.tiles.map(initBasicSprite);
            Sprite.tilebg = SpriteSheet.tilebg.map(initBasicSprite);
        },

        /**
         * A small helper that draws a sprite onto a canvas, respecting the anchor point of
         * the sprite. Note that the canvas should be PRE-TRANSLATED and PRE-ROTATED, if
         * that's appropriate!
         */
        drawSprite(ctx, sprite, u, v) {
            ctx.drawImage(sprite.img, u - sprite.anchor.x, v - sprite.anchor.y);
        },

        drawViewportSprite(sprite, pos, rotation) {
            let { u, v } = this.viewportSprite2uv(
                sprite,
                pos
            );
            if (rotation) {
                Viewport.ctx.save();
                Viewport.ctx.translate(u + sprite.anchor.x, v + sprite.anchor.y);
                Viewport.ctx.rotate(rotation);
                Viewport.ctx.drawImage(
                    sprite.img,
                    -sprite.anchor.x,
                    -sprite.anchor.y
                );
                Viewport.ctx.restore();
            } else {
                Viewport.ctx.drawImage(sprite.img, u, v);
            }
        },

        drawSmashedSprite(sprite, pos, height) {
            let { u, v } = this.viewportSprite2uv(
                sprite,
                pos
            );

            Viewport.ctx.drawImage(sprite.img, u - 1, v - height + sprite.img.height, sprite.img.width + 2, height);
        },

        viewportSprite2uv(sprite, pos) {
            return {
                u: pos.x - sprite.anchor.x - Camera.pos.x + Viewport.center.u,
                v: pos.y - sprite.anchor.y - Camera.pos.y + Viewport.center.v
            };
        },

        getDynamicTile(bitmask) {
            if (!this.tiles[bitmask + TILE_DYNAMIC - 1]) {
                this.tiles[bitmask + TILE_DYNAMIC - 1] = initDynamicSprite(createDynamicTile(this.tiles, bitmask), { x: 0, y: 0 });
            }

            return this.tiles[bitmask + TILE_DYNAMIC - 1];
        }
    };

    // Sprite utility functions

    function initBasicSprite(data, opts) {
        return initDynamicSprite(loadCacheSlice(...data), opts);
    }

    function initDynamicSprite(source, opts) {
        let w = source.width,
            h = source.height;

        if (typeof opts !== 'object') {
            opts = {};
        }

        if (!opts.anchor) {
            opts.anchor = { x: (w / 2) | 0, y: (h / 2) | 0 };
        }

        if (!opts.bb) {
            opts.bb = [-opts.anchor.x, -opts.anchor.y, source.width, source.height];
        }

        return {
            img: source,
            ...opts
        };
    }

    function loadCacheSlice(x, y, w, h) {
        const source = Sprite.sheet;
        const sliceCanvas = createCanvas(w, h);
        sliceCanvas.ctx.drawImage(source, x, y, w, h, 0, 0, w, h);
        return sliceCanvas.canvas;
    }

    function createDynamicTile(tiles, bitmask) {
        let canvas = createCanvas(TILE_SIZE, TILE_SIZE);

        // First, we render outer corners

        if (bitmask & 0b100_000_000) {
            canvas.ctx.drawImage(tiles[TILE_CORNER_OUTER - 1].img, 0, 0, 4, 4, 0, 0, 4, 4);
        }
        if (bitmask & 0b001_000_000) {
            canvas.ctx.drawImage(tiles[TILE_CORNER_OUTER - 1].img, 5, 0, 3, 3, 5, 0, 3, 3);
        }
        if (bitmask & 0b000_000_001) {
            canvas.ctx.drawImage(tiles[TILE_CORNER_OUTER - 1].img, 6, 6, 2, 2, 6, 6, 2, 2);
        }
        if (bitmask & 0b000_000_100) {
            canvas.ctx.drawImage(tiles[TILE_CORNER_OUTER - 1].img, 0, 5, 3, 3, 0, 5, 3, 3);
        }

        // Next we render standard walls (potentially overwriting outer corners above)

        if (bitmask & 0b000_001_000) {
            canvas.ctx.drawImage(tiles[TILE_WALL_LEFT - 1].img, 5, 0, 3, 8, 5, 0, 3, 8);
        }
        if (bitmask & 0b000_100_000) {
            canvas.ctx.drawImage(tiles[TILE_WALL_RIGHT - 1].img, 0, 0, 4, 8, 0, 0, 4, 8);
        }
        if (bitmask & 0b000_000_010) {
            canvas.ctx.drawImage(tiles[TILE_WALL_TOP - 1].img, 0, 5, 8, 3, 0, 5, 8, 3);
        }
        if (bitmask & 0b010_000_000) {
            canvas.ctx.drawImage(tiles[TILE_WALL_BOTTOM - 1].img, 0, 0, 8, 4, 0, 0, 8, 4);
        }

        // Next we render inner corners (potentially overwriting parts of walls above)

        if ((bitmask & 0b010_100_000) === 0b010_100_000) {
            canvas.ctx.drawImage(tiles[TILE_CORNER_INNER - 1].img, 0, 0, 5, 5, 0, 0, 5, 5);
        }
        if ((bitmask & 0b010_001_000) === 0b010_001_000) {
            canvas.ctx.drawImage(tiles[TILE_CORNER_INNER - 1].img, 4, 0, 4, 4, 4, 0, 4, 4);
        }
        if ((bitmask & 0b000_001_010) === 0b000_001_010) {
            canvas.ctx.drawImage(tiles[TILE_CORNER_INNER - 1].img, 4, 4, 4, 4, 4, 4, 4, 4);
        }
        if ((bitmask & 0b000_100_010) === 0b000_100_010) {
            canvas.ctx.drawImage(tiles[TILE_CORNER_INNER - 1].img, 0, 4, 5, 4, 0, 4, 5, 4);
        }

        return canvas.canvas;
    }

    function flipHorizontal(source) {
        let canvas = createCanvas(source.width, source.height);
        canvas.ctx.translate(source.width, 0);
        canvas.ctx.scale(-1, 1);
        canvas.ctx.drawImage(source, 0, 0);
        return canvas.canvas;
    }

    // Text

    const C_WIDTH = 3;
    const C_HEIGHT = 5;

    // Very simple variable-width font implementation. The characters in the font strip
    // are left-aligned in their 3x5 pixel boxes, so in order to have variable width,
    // we just need to note the characters that AREN'T full width. Anything not in
    // this list has full shift (3+1 = 4 pixels).
    const C_SHIFT = {
        10: 0, // LF (\n)
        32: 3, // Space ( )
        33: 3, // Bang (!)
        39: 2, // Apostrophe (')
        44: 3, // Comma (,)
        46: 3, // Period (.)
        73: 2 // I
    };

    const C_ICONS = {};

    const Text = {
        init() {
            Text.white = Sprite.font.img;

            Text.black = recolor(Text.white, rgba(0, 0, 0, 1));
            Text.black_shadow = recolor(Text.white, rgba(90, 20, 90, 0.15));
            Text.blue = recolor(Text.white, rgba(200, 40, 220, 1));
            Text.blue_shadow = recolor(Text.white, rgba(240, 50, 200, 0.2));
            //Text.shadow = recolor(Text.white, rgba(240, 240, 255, 0.25));
            Text.red = recolor(Text.white, rgba(240, 50, 50, 1));

            Text.shadow = recolor(Text.white, rgba(44, 27, 46, 1));
            Text.tan = recolor(Text.white, rgba(209, 180, 140, 1));

            Text.pig = recolor(Text.white, rgba(227, 66, 98, 1));

            //Text.duotone = recolorDuotone(Text.white, '#ffaa5e', '#ffd4a3');
            Text.duotone = recolorDuotone(Text.white, '#f2b63d', '#fff4e0');
            Text.duotone_red = recolorDuotone(Text.white, '#ffaa5e', '#ffd4a3', rgba(255, 0, 0, 0.7));
        },

        drawText(ctx, text, u, v, scale = 1, font = Text.duotone, shadow) {
            for (let c of this.charactersToDraw(text, scale)) {
                if (C_ICONS[c.c]) {
                    ctx.drawImage(
                        C_ICONS[c.c].img,
                        u + c.u,
                        v + c.v - (C_ICONS[c.c].img.height + 4) / 2
                    );
                } else {
                    let k = (c.c - 32) * (C_WIDTH + 1);
                    if (shadow) {
                        ctx.drawImage(
                            shadow,
                            k % 180,
                            (k / 180 | 0) * 6,
                            C_WIDTH,
                            C_HEIGHT,
                            u + c.u,
                            v + c.v + 1,
                            C_WIDTH * scale,
                            C_HEIGHT * scale
                        );
                    }
                    ctx.drawImage(
                        font,
                        k % 180,
                        (k / 180 | 0) * 6,
                        C_WIDTH,
                        C_HEIGHT,
                        u + c.u,
                        v + c.v,
                        C_WIDTH * scale,
                        C_HEIGHT * scale
                    );
                }
            }
        },

        /*
        drawRightText(ctx, text, u, v, scale = 1, font = Text.white, shadow) {
            u -= Text.measureWidth(text, scale);
            Text.drawText(ctx, text, u, v, scale, font, shadow);
        },
        */

        drawParagraph(ctx, text, u, v, w, h, scale = 1, font = Text.duotone, shadow) {
            let cu = u,
                cv = v,
                phrases = text.split(' ');

            for (let phrase of phrases) {
                while (phrase[0] === '\n') {
                    phrase = phrase.slice(1);
                    cu = u;
                    cv += (C_HEIGHT + 1) * scale;
                }
                let phraseWidth = Text.measureWidth(phrase, scale);
                if (cu + phraseWidth - u > w) {
                    cu = u;
                    cv += (C_HEIGHT + 1) * scale;
                }
                Text.drawText(ctx, phrase, cu, cv, scale, font, shadow);
                cu += phraseWidth + (C_SHIFT[32] );
            }
        },

        measureWidth(text, scale) {
            return text.split('').reduce((sum, c) => sum + (C_SHIFT[c.charCodeAt(0)] || 4), 0) * scale;
        },

        measure(text, scale = 1) {
            let w = 0, h = 0;

            for (let c of this.charactersToDraw(text, scale)) {
                w = Math.max(w, c.u + (C_SHIFT[c.c] || C_WIDTH + 1) * scale);
                h = c.v + (C_HEIGHT + 2) * scale;
            }

            return { w, h };
        },

        *charactersToDraw(text, scale = 1) {
            let u = 0, v = 0;

            for (let idx = 0; idx < text.length; idx++) {
                let c = text.charCodeAt(idx);

                if (c === 10) {
                    u = 0;
                    v += (C_HEIGHT + 2) * scale;
                    continue;
                }

                yield { c, u, v };

                u += (C_SHIFT[c] || C_WIDTH + 1) * scale;
            }
        }
    };

    // Text utility functions


    function recolor(font, color) {
        let canvas = createCanvas(font.width, font.height);
        canvas.ctx.fillStyle = color;
        canvas.ctx.fillRect(0, 0, font.width, font.height);
        canvas.ctx.globalCompositeOperation = 'destination-in';
        canvas.ctx.drawImage(font, 0, 0);
        return canvas.canvas;
    }

    function recolorDuotone(font, topColor, bottomColor, tint) {
        // Note: shortcut assumes that the font image is exactly 2 rows of characters.
        let canvas = createCanvas(font.width, font.height);
        canvas.ctx.fillStyle = bottomColor;
        canvas.ctx.fillRect(0, 0, font.width, font.height);
        canvas.ctx.fillStyle = topColor;
        canvas.ctx.fillRect(0, 0, font.width, 1);
        canvas.ctx.fillRect(0, C_HEIGHT + 1, font.width, 1);
        if (tint) {
            canvas.ctx.fillStyle = tint;
            canvas.ctx.fillRect(0, 0, font.width, font.height);
        }
        canvas.ctx.globalCompositeOperation = 'destination-in';
        canvas.ctx.drawImage(font, 0, 0);
        return canvas.canvas;
    }

    // Gore

    class LittlePigBoxParticle {
        constructor(frame, pos, angle, r) {
            this.frame = frame;
            this.pos = { ...pos };
            this.angle = angle;
            this.vel = vector2point(angle2vector(this.angle, 1.7));
            this.a = 10 * Math.PI / 180;
            this.noClipEntity = true;
            //this.bounce = true;
            this.radius = 1;
            this.r = r;
            this.t = -1;
            this.d = 60;

            // TEMPORARY
            //this.noClipWall = true;
        }

        update() {
            if (++this.t === this.d) this.cull = true;
            this.vel.x *= 0.9;
            this.vel.y = clamp(this.vel.y + 0.11, -10, 2);
            this.a *= 0.99;
            this.r += this.a;
        }

        draw() {
            Sprite.drawViewportSprite(Sprite.littlepigbox[this.frame], this.pos, this.r);
        }
    }

    // Gore

    class ExplosionAParticle {
        constructor(pos) {
            this.frame = 0;
            this.pos = { ...pos };
            this.noClipEntity = true;
            this.t = -1;
            this.d = 30;

            // TEMPORARY
            this.noClipWall = true;
        }

        update() {
            if (++this.t === this.d) this.cull = true;
            if (this.t === 16) this.frame++;
            if (this.t === 25) this.frame++;
        }

        draw() {
            Sprite.drawViewportSprite(Sprite.explosiona[this.frame], this.pos, this.r);
        }
    }

    // Gore

    class StarParticle {
        constructor(pos, extra) {
            this.frame = 0;
            this.pos = { ...pos };
            this.angle = Math.random() * Math.PI * 2;
            this.vel = vector2point(angle2vector(this.angle, 2.7));
            this.a = 10 * Math.PI / 180;
            this.noClipEntity = true;
            this.radius = 1;
            this.r = Math.random() * Math.PI * 2;
            this.t = -1 - (extra || 0);
            this.d = 12;
            this.z = 1;

            // TEMPORARY
            this.noClipWall = true;
        }

        update() {
            if (++this.t === this.d) this.cull = true;
            this.vel.x *= 0.9;
            this.vel.y *= 0.9;
            //this.vel.x *= 0.9;
            //this.vel.y = clamp(this.vel.y + 0.11, -10, 2);
            this.a *= 0.99;
            this.r += this.a;
        }

        draw() {
            Sprite.drawViewportSprite(Sprite.star2[this.frame], this.pos, this.r);
        }
    }

    class LittlePig {
        constructor(pos) {
            this.pos = { ...pos };
            this.vel = { x: 0, y: 0 };
            this.bb = [{ x: -7, y: -5 }, { x: 7, y: 6 }];
            this.t = 0;
            this.r = 0;
            this.z = 5;
            this.immune = true;

            this.noClipWall = true;
            this.noClipEntity = true;
            this.newClip = true;
            this.id = Math.random();
        }

        update() {
            console.log('UPDATE on little pig', this);
            this.t++;

            if (this.t === 5) {
                this.vel.y = JUMP_VELOCITY - GRAVITY;
                this.newClip = false;
                Audio.play(Audio.littleJump);
            } else if (this.t > 5 && this.t < 32) {
                this.r = (this.t / 32) * Math.PI * 2;
            } else if (this.t === 32) {
                this.r = 0;
                this.vel.x = 3.7;
                this.vel.y = JUMP_VELOCITY - GRAVITY - GRAVITY;
                Audio.play(Audio.littleEscape);
            } else if (this.t > 32) {
                this.vel.y -= GRAVITY * 0.5;
            }

            if (this.t % 3 === 0) {
                game.screen.addEntity(new StarParticle(this.pos, 0));
            }

            this.vel.y += GRAVITY * 0.9;

    /*        if (this.t > 80) {
                this.r += 2 * Math.PI / 180;
            }

            if (this.t > 90) {
                this.r += 2 * Math.PI / 180;
            }

            if (this.t > 100) {
                this.r += 2 * Math.PI / 180;
                this.vel.x += 0.05;
            }*/

            //if (this.vel.y > TERMINAL_VELOCITY) this.vel.y = TERMINAL_VELOCITY;

            if (this.vel.x > 0) this.facing = 0;
            if (this.vel.x < 0) this.facing = 1;

            if (xy2uv(this.pos).u > Viewport.width) {
                let culled = this.cull;
                this.cull = true;
                game.screen.rescueLittlePig();
                console.log('CALLING rescue pig ', this.pos, this.id, this.cull, culled);
                console.log((new Error('hello')).stack);
            }
        }

        draw() {
            Sprite.drawViewportSprite(Sprite.littlepig[0][0], this.pos, this.r);
        }
    }

    // LittlePigBox

    const SIGN_TEXT = [
        'pn TO MOVE HAROLD', //1
        'SPACEBAR TO JUMP', //2
        '', //3
        'HAROLD IS HEAVY! SLAM THE GROUND\n' +
        'NEAR CRATES TO BREAK THEM OPEN', //4
        'BREAK OPEN EVERY CRATE AND RESCUE\n' +
        'YOUR FRIENDS TO COMPLETE THE LEVEL', //5
        'THE KING\'S KNIGHTS ARE STILL LOOKING FOR \n' +
        'YOU... TRY LANDING ON THEM!', //6
        'SOME FLOATING PLATFORMS ARE UNSTABLE.\n' +
        'LAND ON THEM HARD ENOUGH AND YOU CAN\n' +
        'TEMPORARILY KNOCK THEM DOWN!' //7
    ];

    class Sign {
        constructor(qr, signNumber) {
            this.qr = { ...qr };
            this.bb = [{ x: -7, y: -5 }, { x: 7, y: 6 }];
            this.immune = true;
            this.signIndex = signNumber - 1;

            this.pos = centerxy(qr2xy(qr));
            this.pos.y = (qr.r + 1) * TILE_SIZE - this.bb[1].y;
            this.t = 0;

            this.text = SIGN_TEXT[this.signIndex];
            this.displayOverlay = false;
            this.overlaySize = Text.measure(this.text);
        }

        update() {
            this.t++;

            if (this.shakeX > 0) this.shakeX--;
            if (this.shakeY > 0) this.shakeY--;

            if (!this.shakeY && !this.shakeX && Math.random() < 0.01) {
                this.shakeX = 30;
            }
            if (!this.shakeY && !this.shakeX && Math.random() < 0.01) {
                this.shakeY = 8;
            }

            this.displayOverlay = (manhattanXY(this.pos, game.screen.player.pos) < 12);
        }

        draw() {
            let shakeX = 0, shakeY = 0;
            Sprite.drawViewportSprite(Sprite.sign[0], { x: this.pos.x + shakeX, y: this.pos.y + shakeY });
        }

        drawOverlay() {
            let u = (Viewport.width - this.overlaySize.w) / 2;
            let v = (Viewport.height / 2) + 24;

            Viewport.ctx.fillStyle = rgba(44, 27, 46, 0.6);
            Viewport.ctx.fillRect(u - 2, v - 2, this.overlaySize.w + 3, this.overlaySize.h + 2);

            Text.drawText(Viewport.ctx, this.text, (Viewport.width - this.overlaySize.w) / 2, (Viewport.height / 2) + 24, 1, Text.white, Text.shadow);
        }
    }

    // Movement

    const Movement = {
        perform(level, entities) {
            // Movement only applies to active entities with positions and velocities
            let movers = entities.filter(
                entity => entity.pos && entity.vel && !entity.cull
            );

            // Very basic "rounds" of collision resolution, since we have no real physics.
            // (As usual, "detecting" a collision is not the hard part... we need to resolve
            // them too!)
            for (let rounds = 0; rounds < 5; rounds++) {
                for (let entity of movers) {
                    Movement.clipVelocityAgainstTiles2(level, entity);
                }
            }

            // Now we perform all movement, even if it's not going to be perfect.
            for (let entity of movers) {
                entity.pos.x += entity.vel.x;
                entity.pos.y += entity.vel.y;
            }
        },

        clipVelocityAgainstTiles2(level, entity) {
            if (!entity.newClip) return;

            let xArray = [
                entity.pos.x + entity.bb[0].x,
                entity.pos.x + entity.bb[1].x
            ];

            let yArray = [
                entity.pos.y + entity.bb[0].y,
                entity.pos.y + entity.bb[1].y
            ];

            if (entity.vel.x <= 0) {
                xArray[0] += entity.vel.x;
            } else {
                xArray[1] += entity.vel.x;
            }

            if (entity.vel.y <= 0) {
                yArray[0] += entity.vel.y;
            } else {
                yArray[1] += entity.vel.y;
            }

            let bounds = [
                { x: xArray[0], y: yArray[0] },
                { x: xArray[1], y: yArray[1] }
            ];

            for (let tile of tilesHitInBounds(bounds)) {
                if (!level.tileIsPassable(tile.q, tile.r)) {
                    let tileXY = qr2xy(tile);

                    // This algorithm is kind of a practical approach to the question of
                    // how to interact with tiles hit while moving. Instead of computing the
                    // the normal of our velocity into the sides of a tile hit, we compute
                    // what we WOULD do if we chose to bounce off the X side or Y side of
                    // a tile, and then we pick whichever one will move the player the least.
                    //
                    // This generally gives behavior that feels "expected" - jumping into the side
                    // of a block results in stopping and sliding down, while jumping into the
                    // bottom of a block results in hitting your head.

                    let suggested = [];

                    if (tileXY.y + JUMP_CHEAT_Y_PIXELS >= entity.pos.y + entity.bb[1].y) {
                        let lowestAllowedY = tileXY.y - entity.bb[1].y;
                        suggested.push({
                            pos: { x: entity.pos.x, y: lowestAllowedY },
                            vel: { x: entity.vel.x, y: 0 },
                            tile: tile
                        });
                    }
                    if (tileXY.x >= entity.pos.x + entity.bb[1].x) {
                        let rightmostAllowedX = tileXY.x - entity.bb[1].x;
                        suggested.push({
                            pos: { x: rightmostAllowedX, y: entity.pos.y },
                            vel: { x: 0, y: entity.vel.y }
                        });
                    }
                    if (tileXY.x <= entity.pos.x - entity.bb[1].x) {
                        let leftmostAllowedX = tileXY.x + TILE_SIZE - entity.bb[0].x;
                        suggested.push({
                            pos: { x: leftmostAllowedX, y: entity.pos.y },
                            vel: { x: 0, y: entity.vel.y }
                        });
                    }
                    if (tileXY.y < entity.pos.y) {
                        let highestAllowedY = tileXY.y + TILE_SIZE - entity.bb[0].y;
                        suggested.push({
                            pos: { x: entity.pos.x, y: highestAllowedY },
                            vel: { x: entity.vel.x, y: 0 }
                        });
                    }

                    let chosen = suggested[0];
                    let pixelDistance = vectorBetween(entity.pos, chosen.pos).m;
                    for (let i = 1; i < suggested.length; i++) {
                        let newPixelDistance = vectorBetween(entity.pos, suggested[i].pos).m;
                        if (newPixelDistance < pixelDistance) {
                            pixelDistance = newPixelDistance;
                            chosen = suggested[i];
                        }
                    }

                    entity.pos = chosen.pos;
                    entity.vel = chosen.vel;
                    if (chosen.tile && entity.landedOnTile) entity.landedOnTile(tile);
                }
            }
        }
    };

    // VictoryScreen

    class VictoryScreen {
        constructor() {
            this.text = [
                'THANKS FOR PLAYING ACT 1 OF HAROLD IS HEAVY!',
                '',
                'ACT 1 IS SHAREWARE. TO FINISH HAROLD\'S ADVENTURE,',
                'ORDER THE FULL GAME VIA CHECK OR MONEY ORDER USING',
                'THE ORDER.FRM FILE DISTRIBUTED WITH YOUR GAME.',
                '',
                'THANK YOU FOR SUPPORTING THE SHAREWARE MOVEMENT.'
            ];
            this.frames = 0;
        }

        update() {
            this.frames++;

            return true;
        }

        draw() {
            Viewport.ctx.fillStyle = '#457cd6';
            Viewport.ctx.fillRect(0, 0, Viewport.width, Viewport.height);

            for (let i = 0; i < this.text.length; i++) {
                let width = Text.measure(this.text[i], 1).w;
                Text.drawText(Viewport.ctx, this.text[i], (Viewport.width - width) / 2, 24 + i * 10, 1, Text.white, Text.shadow);
            }
        }
    }

    // LevelData
    //
    // This file is generated by `gulp buildAssets`.

    const LevelData =
    /* <generated-data> */
    [
        {
            "floors": [
                {
                    "name": "FLOOR1",
                    "tiles": [
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            1,
                            1,
                            1,
                            0,
                            1,
                            1,
                            1,
                            1,
                            1,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            1,
                            2,
                            2,
                            2,
                            1,
                            2,
                            2,
                            2,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            3,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            1,
                            1,
                            1,
                            1,
                            1,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            8,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            2,
                            2,
                            2,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            1,
                            1,
                            1,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            3,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            1,
                            1,
                            1,
                            1,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            9,
                            9,
                            9,
                            9,
                            9,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            9,
                            9,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            1,
                            8
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            2,
                            2,
                            2,
                            2,
                            2,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            2,
                            2,
                            2
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            1,
                            1,
                            1,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            1,
                            1,
                            1,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4
                        ],
                        [
                            7,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            9,
                            9,
                            0,
                            0,
                            0,
                            3,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            3,
                            4
                        ],
                        [
                            0,
                            0,
                            0,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            1,
                            1,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            3,
                            4
                        ],
                        [
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            2,
                            2,
                            2,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            1,
                            1,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            3,
                            4
                        ],
                        [
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            3,
                            4
                        ],
                        [
                            0,
                            0,
                            0,
                            4,
                            4,
                            3,
                            4,
                            4,
                            3,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            3,
                            4
                        ],
                        [
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            0,
                            4,
                            4,
                            3,
                            4,
                            4,
                            3,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            0,
                            4,
                            4,
                            3,
                            4,
                            4,
                            3,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ]
                    ],
                    "objects": [
                        {
                            "name": "SPAWN",
                            "x": 2,
                            "y": 0
                        },
                        {
                            "name": "SIGN01",
                            "x": 2,
                            "y": 11
                        },
                        {
                            "name": "SIGN02",
                            "x": 11,
                            "y": 11
                        },
                        {
                            "name": "BOX",
                            "x": 51,
                            "y": -1
                        },
                        {
                            "name": "SIGN04",
                            "x": 44,
                            "y": 3
                        },
                        {
                            "name": "BOX",
                            "x": 67,
                            "y": 7
                        },
                        {
                            "name": "SIGN05",
                            "x": 55,
                            "y": -1
                        }
                    ],
                    "areas": [],
                    "id": 0
                }
            ],
            "bounds": [
                [
                    0,
                    0
                ],
                [
                    69,
                    24
                ]
            ],
            "spawn": [
                2,
                0,
                0
            ]
        },
        {
            "floors": [
                {
                    "name": "FLOOR1",
                    "tiles": [
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            0,
                            5,
                            0,
                            5
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            5,
                            5,
                            5,
                            5
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            6,
                            6,
                            6,
                            6,
                            5
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            6,
                            6,
                            6,
                            6,
                            5
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            1,
                            1,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            1,
                            1,
                            0,
                            0,
                            0,
                            9,
                            0,
                            0,
                            0,
                            9,
                            0,
                            0,
                            0,
                            9,
                            0,
                            0,
                            0,
                            1,
                            1,
                            1,
                            1,
                            0,
                            0,
                            0,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            8,
                            0,
                            2,
                            2,
                            0,
                            0,
                            9,
                            9,
                            9,
                            0,
                            0,
                            0,
                            9,
                            9,
                            9,
                            0,
                            0,
                            2,
                            2,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            2,
                            2,
                            2,
                            2,
                            2
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            8,
                            0,
                            2,
                            2,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            8,
                            0,
                            2,
                            2,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            1,
                            0,
                            1,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            3,
                            4,
                            4
                        ],
                        [
                            7,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            1,
                            1,
                            8,
                            0,
                            2,
                            2,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            3,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            2,
                            2,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            2,
                            4,
                            4,
                            1,
                            1,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            1,
                            1,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            3,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            3,
                            3,
                            3,
                            3,
                            3,
                            3,
                            3,
                            3,
                            3,
                            4,
                            4,
                            4,
                            4,
                            2,
                            2,
                            2,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            3,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            3,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            1,
                            1,
                            1,
                            8,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            3,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            4,
                            4,
                            4,
                            3,
                            3,
                            3,
                            4,
                            4,
                            4,
                            0,
                            7,
                            1,
                            1,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            3,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            4,
                            4,
                            3,
                            3,
                            3,
                            3,
                            3,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            4,
                            4,
                            4,
                            3,
                            3,
                            3,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            3,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4
                        ],
                        [
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            4
                        ]
                    ],
                    "objects": [
                        {
                            "name": "SPAWN",
                            "x": 4,
                            "y": 2
                        },
                        {
                            "name": "BOX",
                            "x": 47,
                            "y": 9
                        },
                        {
                            "name": "KNIGHT",
                            "x": 15,
                            "y": 13
                        },
                        {
                            "name": "KNIGHT",
                            "x": 22,
                            "y": 12
                        },
                        {
                            "name": "KNIGHT",
                            "x": 45,
                            "y": 6
                        },
                        {
                            "name": "KNIGHT",
                            "x": 49,
                            "y": 6
                        },
                        {
                            "name": "BOX",
                            "x": 69,
                            "y": 10
                        },
                        {
                            "name": "BOX",
                            "x": 58,
                            "y": 10
                        },
                        {
                            "name": "SIGN06",
                            "x": 26,
                            "y": 9
                        },
                        {
                            "name": "BOX",
                            "x": 81,
                            "y": 5
                        },
                        {
                            "name": "KNIGHT",
                            "x": 79,
                            "y": -1
                        },
                        {
                            "name": "KNIGHT",
                            "x": 83,
                            "y": -1
                        }
                    ],
                    "areas": [],
                    "id": 0
                }
            ],
            "bounds": [
                [
                    0,
                    0
                ],
                [
                    84,
                    22
                ]
            ],
            "spawn": [
                4,
                2,
                0
            ]
        },
        {
            "floors": [
                {
                    "name": "FLOOR1",
                    "tiles": [
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            0,
                            5,
                            0,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            9,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            5,
                            0,
                            0,
                            0,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            5,
                            5,
                            5,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            5,
                            5,
                            5,
                            5,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            5,
                            0,
                            5,
                            0,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            0,
                            5,
                            0,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            5,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            5,
                            5,
                            5,
                            5,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            5,
                            5,
                            5,
                            5,
                            0,
                            0,
                            0,
                            0,
                            1,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            5,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            5,
                            0,
                            0,
                            5,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            5,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            1,
                            1,
                            1,
                            8,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            5,
                            5,
                            5,
                            5,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            5,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            9,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            5,
                            6,
                            6,
                            6,
                            6,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            1,
                            1,
                            1,
                            8,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            7,
                            1,
                            1,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            5,
                            6,
                            6,
                            6,
                            6,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            5,
                            5,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            5,
                            6,
                            6,
                            6,
                            6,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            1,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            5,
                            6,
                            6,
                            6,
                            6,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            7,
                            1,
                            1,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            5,
                            5,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            2,
                            2,
                            2,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            5,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            9,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            1,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            9,
                            0,
                            0,
                            0,
                            0,
                            2,
                            2,
                            2,
                            2,
                            9,
                            9,
                            9,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            1
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            3,
                            3,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            1,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            3,
                            3,
                            3,
                            3,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            2,
                            2,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            9,
                            3,
                            3,
                            3,
                            3,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            1,
                            1,
                            1,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            2,
                            2,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            3,
                            3,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            9,
                            9,
                            9,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            2,
                            2,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            1,
                            1,
                            1,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            2,
                            2,
                            1,
                            8,
                            0,
                            0,
                            7,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            3,
                            0,
                            0,
                            0,
                            4,
                            4,
                            2,
                            2,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            3,
                            0,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            3,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ]
                    ],
                    "objects": [
                        {
                            "name": "SPAWN",
                            "x": 2,
                            "y": 7
                        },
                        {
                            "name": "BOX",
                            "x": 48,
                            "y": 19
                        },
                        {
                            "name": "SLAM",
                            "x": 26,
                            "y": 23
                        },
                        {
                            "name": "SIGN07",
                            "x": 22,
                            "y": 16
                        },
                        {
                            "name": "SLAM",
                            "x": 7,
                            "y": 0
                        },
                        {
                            "name": "BOX",
                            "x": 2,
                            "y": 3
                        },
                        {
                            "name": "BOX",
                            "x": 32,
                            "y": 16
                        }
                    ],
                    "areas": [],
                    "id": 0
                }
            ],
            "bounds": [
                [
                    0,
                    0
                ],
                [
                    52,
                    32
                ]
            ],
            "spawn": [
                2,
                7,
                0
            ]
        },
        {
            "floors": [
                {
                    "name": "FLOOR1",
                    "tiles": [
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            0,
                            5,
                            0,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            5,
                            5,
                            5,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            6,
                            6,
                            6,
                            6,
                            6,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            6,
                            6,
                            6,
                            6,
                            6,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            9,
                            0,
                            0,
                            0,
                            9,
                            0,
                            0,
                            0,
                            9,
                            0,
                            0,
                            0,
                            6,
                            6,
                            6,
                            6,
                            6,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            5,
                            6,
                            6,
                            6,
                            5,
                            5
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            5,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            5,
                            0,
                            0,
                            5,
                            0,
                            0,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            5,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            5,
                            5,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            5,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            6,
                            6,
                            6,
                            6,
                            5,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            6,
                            6,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            0,
                            5,
                            0,
                            5,
                            0,
                            5,
                            0,
                            5,
                            0,
                            5,
                            0,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            6,
                            6,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            6,
                            6,
                            6,
                            5,
                            6,
                            5,
                            6,
                            5,
                            6,
                            5,
                            6,
                            5,
                            6,
                            5,
                            6,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            7,
                            1,
                            1,
                            1,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            6,
                            6,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            6,
                            6,
                            5,
                            5,
                            5,
                            5,
                            6,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            2,
                            2,
                            2,
                            5,
                            6,
                            6,
                            5,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            4,
                            4,
                            5,
                            6,
                            6,
                            5,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            3,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            6,
                            6,
                            5,
                            6,
                            6,
                            5,
                            5,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            5,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            5,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            5,
                            6,
                            6,
                            5,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            5,
                            6,
                            6,
                            6,
                            5,
                            6,
                            6,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            6,
                            6,
                            6,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            6,
                            6,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            5,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            9,
                            9,
                            9,
                            9,
                            9,
                            9,
                            9,
                            0,
                            0,
                            0,
                            9,
                            9,
                            9,
                            9,
                            9,
                            0,
                            0,
                            0,
                            0,
                            0,
                            9,
                            9,
                            9,
                            9,
                            9,
                            9,
                            9,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            9,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            7,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            2,
                            2,
                            2,
                            0,
                            0,
                            0,
                            7,
                            1,
                            1,
                            8,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            0,
                            9,
                            0,
                            2,
                            2,
                            2,
                            2,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ],
                        [
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            4,
                            4,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0,
                            0
                        ]
                    ],
                    "objects": [
                        {
                            "name": "SPAWN",
                            "x": 1,
                            "y": 17
                        },
                        {
                            "name": "KNIGHT",
                            "x": 7,
                            "y": 21
                        },
                        {
                            "name": "KNIGHT",
                            "x": 16,
                            "y": 24
                        },
                        {
                            "name": "KNIGHT",
                            "x": 15,
                            "y": 27
                        },
                        {
                            "name": "BOX",
                            "x": 12,
                            "y": 31
                        },
                        {
                            "name": "BOX",
                            "x": 5,
                            "y": 16
                        },
                        {
                            "name": "BOX",
                            "x": 25,
                            "y": 27
                        },
                        {
                            "name": "KNIGHT",
                            "x": 27,
                            "y": 25
                        },
                        {
                            "name": "KNIGHT",
                            "x": 12,
                            "y": 24
                        },
                        {
                            "name": "SLAM",
                            "x": 12,
                            "y": 16
                        }
                    ],
                    "areas": [],
                    "id": 0
                }
            ],
            "bounds": [
                [
                    0,
                    0
                ],
                [
                    32,
                    38
                ]
            ],
            "spawn": [
                1,
                17,
                0
            ]
        }
    ]
    /* </generated-data> */
    ;

    // Gore

    class LandingParticle {
        constructor(pos) {
            this.pos = { ...pos };
            this.pos.x += Math.random() * 8 - 4;
            this.angle = Math.random() * Math.PI * 2;
            this.vel = vector2point(angle2vector(this.angle, 1.7));

            //this.bounce = true;
            this.radius = 1;
            this.r = 0;
            this.t = -1;
            this.d = 60;

            // TEMPORARY
            this.noClipWall = true;
            this.noClipEntity = true;
        }

        update() {
            if (++this.t === this.d) this.cull = true;
            this.vel.x *= 0.9;
            this.vel.y = clamp(this.vel.y + 0.05, -10, 1.5);
            //this.a *= 0.99;
            //this.r += this.a;
        }

        draw() {
            //Sprite.drawViewportSprite(Sprite.littlepigbox[0], this.pos, this.r);
            Sprite.drawViewportSprite(Sprite.particle[0], this.pos, this.r);
        }
    }

    // ScreenShake

    class ScreenShake {
        constructor(frames, hAmplitude, vAmplitude) {
            this.frames = frames;
            this.hAmplitude = hAmplitude;
            this.vAmplitude = vAmplitude;
            this.hSamples = [];
            this.vSamples = [];

            var sampleCount = frames / 2;
            for (let i = 0; i <= sampleCount; i++) {
                this.hSamples.push(Math.random() * 2 - 1);
                this.vSamples.push(Math.random() * 2 - 1);
            }
            this.frame = -1;
        }

        update() {
            this.frame++;
            if (this.frame >= this.frames) {
                return false;
            }

            // https://jonny.morrill.me/en/blog/gamedev-how-to-implement-a-camera-shake-effect/
            // let s = (this.frames / 10) * (this.frame / this.frames);
            let s = this.frame / 2;
            let s0 = s | 0;
            let s1 = s0 + 1;
            let decay = 1 - this.frame / this.frames;

            this.x =
                this.hAmplitude *
                decay *
                (this.hSamples[s0] +
                    (s - s0) * (this.hSamples[s1] - this.hSamples[s0]));
            this.y =
                this.vAmplitude *
                decay *
                (this.vSamples[s0] +
                    (s - s0) * (this.vSamples[s1] - this.vSamples[s0]));

            return true;
        }
    }

    // Gore

    class ExplosionBParticle {
        constructor(pos) {
            this.frame = 0;
            this.pos = { ...pos };
            this.noClipEntity = true;
            this.t = -1;
            this.d = 30;

            // TEMPORARY
            this.noClipWall = true;
        }

        update() {
            if (++this.t === this.d) this.cull = true;
            if (this.t === 6) this.frame++;
            if (this.t === 12) this.frame++;
            if (this.t === 18) this.frame++;
            if (this.t === 24) this.frame++;
        }

        draw() {
            Sprite.drawViewportSprite(Sprite.explosionb[this.frame], this.pos, this.r);
        }
    }

    // Player

    const PLAYING = 1;
    const DYING = 2;

    class Player {
        constructor(pos) {
            this.pos = { ...pos };
            this.vel = { x: 0, y: 0 };
            this.frame = 0;
            this.radius = 4;
            this.jumpLength = 0;
            this.jumpFrames = 0;
            this.facing = 0;
            this.isJumping = true;
            this.lastJumpPressed = 0;
            this.team = 1;
            this.z = 10;
            this.highestY = this.pos.y;
            this.state = PLAYING;
            this.last = [this.pos, this.pos];

            this.bb = [{ x: -4, y: -4 }, { x: 4, y: 5 }];
            this.hbb = [{ x: -4, y: -4 }, { x: 4, y: 5 }];
            this.abb = [{ x: -6, y: 4 }, { x: 6, y: 5 }];

            // temp
            this.noClipWall = true;
            this.newClip = true;
        }

        update() {
            this.last[1] = { ...this.last[0] };
            this.last[0] = { ...this.pos };

            if (this.state === DYING) {
                this.stateFrames++;
                if (this.stateFrames > 30) {
                    game.restartLevel();
                }
                return;
            }

            if (this.pos.y < this.highestY) {
                this.highestY = this.pos.y;
            }

            let v = {
                x: Input.direction.x * Input.direction.m * PLAYER_FOOT_SPEED,
                y: Input.direction.y * Input.direction.m * 0.4
            };

            this.vel.x = clamp((this.vel.x + v.x) / 2, -PLAYER_FOOT_SPEED, PLAYER_FOOT_SPEED);
            //this.vel.y = (this.vel.y + v.y) / 2;

            // move
            ///this.pos.x += this.vel.x;
            ///this.pos.y += this.vel.y;

            if (Input.pressed[Input.Action.JUMP]) {
                this.lastJumpPressed = game.frame;
            }

            if (!this.isJumping && game.frame - this.lastJumpPressed <= JUMP_CHEAT_LANDING_FRAMES) {
                this.isJumping = true;
                this.lastJumpPressed = 0;
                //this.jumpFrames = 16;
                //this.jumpLength = 0;
                this.vel.y = JUMP_VELOCITY - GRAVITY;
                Audio.play(Audio.playerJump);
            }

            /*if (this.jumpFrames > 0) {
                this.jumpFrames--;
                this.jumpLength++;
                this.vel.y = -1.2;
            }

            if (Input.held[Input.Action.JUMP] && this.jumpFrames < 1 && this.jumpLength < 36) {
                this.jumpFrames = 1;
            }*/

            if (this.vel.y < 0) {
                this.frame = 3;
            } else if (this.vel.y > 0) {
                // If you start falling, you can't jump anymore
                this.isJumping = true;

                this.frame = 4;
                if (this.pos.y - this.highestY > 12) {
                    this.frame = 5;
                }
                /*if (this.pos.y - this.highestY > 32) {
                    this.frame = 6;
                }*/
            } else if (Math.abs(this.vel.x) < 0.1) {
                this.frame = 0;
            } else {
                this.frame = (Math.floor(this.pos.x / 8) % 2) + 1;
            }

            this.vel.y += GRAVITY;
            //this.vel.y += 0.12;

            if (this.vel.y > TERMINAL_VELOCITY) this.vel.y = TERMINAL_VELOCITY;

            if (this.vel.x > 0) this.facing = 0;
            if (this.vel.x < 0) this.facing = 1;
        }

        landedOnTile(tile) {
            let distanceFallen = this.pos.y - this.highestY;
            this.highestY = this.pos.y;

            if (this.isJumping) {
                this.isJumping = false;
            }

            if (distanceFallen > 4) {
                game.screen.landedOnTile(tile, distanceFallen > SUPER_SLAM_FALL_DISTANCE);
                game.screen.screenshakes.push(new ScreenShake(12, 0, 3));
                game.screen.addTileShake(new ScreenShake(15, 0, 9), tile);

                //game.screen.addEntity(new StarParticle(this.pos));
            }
            if (distanceFallen > SUPER_SLAM_FALL_DISTANCE) {
                Audio.play(Audio.playerSlam);
            }
        }

        draw() {
            if (this.state !== DYING) {
                let qr = xy2qr(this.pos);
                let shakemap = game.screen.tileshakemap[qr.r + 1]?.[qr.q];
                let y = shakemap && shakemap.y ? shakemap.y : 0;

                if (this.pos.y - this.highestY > SUPER_SLAM_FALL_DISTANCE) {
                    Viewport.ctx.globalAlpha = 0.2;
                    Sprite.drawViewportSprite(Sprite.bigpig[this.facing][this.frame], { x: this.last[1].x, y: this.pos.y + y - 4 });
                }
                if (this.pos.y - this.highestY > SUPER_SLAM_FALL_DISTANCE) {
                    Viewport.ctx.globalAlpha = 0.4;
                    Sprite.drawViewportSprite(Sprite.bigpig[this.facing][this.frame], { x: this.last[0].x, y: this.pos.y + y - 2 });
                }
                Viewport.ctx.globalAlpha = 1;
                Sprite.drawViewportSprite(Sprite.bigpig[this.facing][this.frame], { x: this.pos.x, y: this.pos.y + y });
            }
        }

        attack(victim) {
            victim.crushedBy(this);
        }

        dieFalling(levelBottomY) {
            if (this.state !== DYING) {
                this.state = DYING;
                this.vel.x = 0;
                this.stateFrames = 0;
                game.screen.addEntity(new ExplosionBParticle({ x: this.pos.x, y: levelBottomY - 2 }));
                Audio.play(Audio.playerDeath);
            }
        }

        dieHit(enemy) {
            if (this.state !== DYING) {
                this.state = DYING;
                this.vel.x = 0;
                this.stateFrames = 0;
                game.screen.addEntity(new ExplosionBParticle({ x: this.pos.x, y: this.pos.y }));
                Audio.play(Audio.playerDeath);
            }
        }
    }

    const Attack = {
        perform(level, entities) {
            let relevantEntities = entities.filter(entity => entity.team);

            relevantEntities.sort((a, b) => a.team - b.team);

            for (let attacker of relevantEntities) {
                if (attacker.abb) {
                    for (let victim of relevantEntities) {
                        if (attacker.team === victim.team || victim.immune) continue;

                        if (victim.bb) {
                            if (isBoundingBoxOverlap(entityABB(attacker), entityHBB(victim))) {
                                attacker.attack(victim);
                            }
                        }
                    }
                }
            }
        }
    };

    // LittlePigBox

    class LittlePigBox {
        constructor(qr) {
            this.qr = { ...qr };
            this.bb = [{ x: -7, y: -5 }, { x: 7, y: 6 }];
            this.immune = true;

            this.pos = centerxy(qr2xy(qr));
            this.pos.y = (qr.r + 1) * TILE_SIZE - this.bb[1].y;
            this.t = 0;

            this.shakeY = 0;
        }

        update() {
            this.t++;

            if (this.shakeX > 0) this.shakeX--;
            if (this.shakeY > 0) this.shakeY--;

            if (!this.shakeY && !this.shakeX && Math.random() < 0.01) {
                this.shakeX = 30;
            }
            if (!this.shakeY && !this.shakeX && Math.random() < 0.01) {
                this.shakeY = 8;
            }
        }

        draw() {
            let shakeX = 0, shakeY = 0;
            if (this.shakeY) shakeY = -1;
            if (this.shakeX) {
                if (this.shakeX > 20 || this.shakeX < 10) shakeX = 1;
            }
            Sprite.drawViewportSprite(Sprite.littlepigbox[0], { x: this.pos.x + shakeX, y: this.pos.y + shakeY });
        }

        landedOnTile(tile) {
            if (this.qr.r === tile.r - 1 && Math.abs(this.qr.q - tile.q) <= 2 && !this.cull) {
                game.screen.addEntity(new ExplosionAParticle({ x: this.pos.x, y: this.pos.y }));
                game.screen.addEntity(new LittlePigBoxParticle(1, { x: this.pos.x, y: this.pos.y }, 225 * Math.PI / 180, 0));
                game.screen.addEntity(new LittlePigBoxParticle(2, { x: this.pos.x + 2, y: this.pos.y }, 246 * Math.PI / 180, 0));
                game.screen.addEntity(new LittlePigBoxParticle(2, { x: this.pos.x + 2, y: this.pos.y }, 292 * Math.PI / 180, R180));
                game.screen.addEntity(new LittlePigBoxParticle(3, { x: this.pos.x + 4, y: this.pos.y }, 270 * Math.PI / 180, R45));
                game.screen.addEntity(new LittlePigBoxParticle(1, { x: this.pos.x + 10, y: this.pos.y }, 315 * Math.PI / 180, 0));
                game.screen.addEntity(new LittlePig(this.pos));
                this.cull = true;
            }
        }
    }

    // Gore

    class BloodPoolParticle {
        constructor(pos) {
            this.frame = 0;
            this.pos = { ...pos };
            this.noClipEntity = true;
            this.t = -1;
            this.d = 56;

            // TEMPORARY
            this.noClipWall = true;

            this.pos.y = this.pos.y + 8 - (this.pos.y % 8) + 2;
        }

        update() {
            if (++this.t === this.d) this.cull = true;

            this.frame = Math.floor(this.t * 8 / 16);
            if (this.frame > 7) this.frame = 7;
        }

        draw() {
            Sprite.drawViewportSprite(Sprite.bleed[this.frame], this.pos);
        }
    }

    // Player
    const MOVE_SPEED = 0.5;

    class Knight {
        constructor(pos) {
            this.pos = { ...pos };
            this.vel = { x: 0, y: 0 };
            this.frame = 0;
            this.radius = 4;
            this.jumpLength = 0;
            this.jumpFrames = 0;
            this.facing = 1;
            this.isJumping = true;
            this.team = 2;
            this.z = 4;

            this.bb = [{ x: -3, y: -6 }, { x: 3, y: 6 }];
            this.hbb = [{ x: -3, y: -6 }, { x: 3, y: 0 }];
            this.abb = [{ x: -3, y: -6 }, { x: 3, y: 6 }];

            // temp
            this.noClipWall = true;
            this.newClip = true;

            this.t = 0;

            this.stack = [];
            this.stack.push({ walk: -1 });
            this.stack.push({ pause: 5 });
        }

        update() {
            this.t++;

            let action = this.stack[this.stack.length - 1];

            if (!game.screen.entityIsOnSolidGround(this)) {
                this.frame = 0;
                this.vel.x *= 0.9;
            } else if (action.pause) {
                this.frame = 0;
                action.pause--;
                if (action.pause < 1) this.stack.pop();
            } else if (action.walk) {
                this.vel.x += this.facing * MOVE_SPEED / 5;
                this.vel.x = clamp(this.vel.x, -MOVE_SPEED, MOVE_SPEED);

                let nextTile = xy2qr({ x: this.pos.x + this.vel.x, y: this.pos.y });
                if (game.screen.tileIsPassable(nextTile.q, nextTile.r + 1) ||
                    (this.vel.x < 0 && (this.pos.x - (nextTile.q - 1) * TILE_SIZE < 12) && !game.screen.tileIsPassable(nextTile.q - 1, nextTile.r)) ||
                    (this.vel.x > 0 && ((nextTile.q + 1) * TILE_SIZE - this.pos.x < 12) && !game.screen.tileIsPassable(nextTile.q + 1, nextTile.r))) {
                    this.vel.x = 0;
                    this.stack.push({ turn: -1 });
                    this.stack.push({ pause: 20 });
                }
                this.frame = Math.floor(this.t / 10) % 2 + 1;
            } else if (action.turn) {
                this.frame = 0;
                this.facing = -this.facing;
                this.vel.x = -this.vel.x;
                this.stack.pop();
            } else if (action.crush) {
                let gap = (this.pos.y + this.bb[1].y) - (this.crusher.pos.y + this.crusher.bb[1].y);
                if (gap <= 2 && !this.exploded) {
                    this.exploded = true;
                    game.screen.addEntity(new BloodPoolParticle(this.pos));
                }
                if (gap === 0) {
                    this.cull = true;
                }
                // do nothing forever
            }

            this.vel.y += GRAVITY;
        }

        draw() {
            if (this.crusher) {
                let gap = (this.pos.y + this.bb[1].y) - (this.crusher.pos.y + this.crusher.bb[1].y);
                Sprite.drawSmashedSprite(Sprite.knight[this.facing === 1 ? 0 : 1][this.frame], { x: this.pos.x, y: this.pos.y }, gap);
            } else {
                Sprite.drawViewportSprite(Sprite.knight[this.facing === 1 ? 0 : 1][this.frame], { x: this.pos.x, y: this.pos.y });
            }
        }

        crushedBy(enemy) {
            this.crusher = enemy;
            this.stack = [{ crush: -1 }];
            this.abb = undefined;
            Audio.play(Audio.enemyDeath);
        }

        attack(victim) {
            victim.dieHit(this);
        }
    }

    // Gore

    class BigArrowParticle {
        constructor(pos) {
            this.frame = 0;
            this.pos = { ...pos };
            this.t = 0;
            this.d = 15;
            this.z = 5;

            // TEMPORARY
            this.noClipEntity = true;
            this.noClipWall = true;
        }

        update() {
            if (++this.t === this.d) this.cull = true;
            this.pos.y += 1;
        }

        draw() {
            Viewport.ctx.globalAlpha = 0.6;
            Sprite.drawViewportSprite(Sprite.bigarrow[this.frame], this.pos);
            Viewport.ctx.globalAlpha = 1;
        }
    }

    // Gore

    class FallingDirtParticle {
        constructor(pos) {
            this.frame = Math.floor(Math.random() * 2);
            this.pos = { ...pos };
            this.t = 0;
            this.d = 15;
            this.z = 4;

            // TEMPORARY
            this.noClipEntity = true;
            this.noClipWall = true;
        }

        update() {
            if (++this.t === this.d) this.cull = true;
            this.pos.y += 0.5;
        }

        draw() {
            Viewport.ctx.globalAlpha = 1;
            Sprite.drawViewportSprite(Sprite.dirt[this.frame], this.pos);
        }
    }

    // Gore

    class CloudParticle {
        constructor(middle) {
            let velDice = Math.floor(Math.random() * 3);
            let velX = [0.1, 0.2, 0.3];

            this.frame = Math.floor(Math.random() * 4);
            this.pos = {
                x: middle ? Viewport.width / 2 + Math.random() * 40 : Viewport.width + 1,
                y: Math.floor(Math.random() * 30 + 2)
            };
            this.vel = {
                x: 0 - velX[velDice],
                y: 0
            };
            this.z = -1;

            // TEMPORARY
            this.noClipWall = true;
            this.noClipEntity = true;
        }

        update() {
            if (this.pos.x < -30) this.cull = true;
        }

        draw() {
            // Our "x,y" is ACTUALLY a "u,v", which is a bit confusing... clouds don't move with
            // the tileset in this game.
            Viewport.ctx.drawImage(Sprite.clouds[this.frame].img, this.pos.x, this.pos.y);
        }
    }

    // LevelScreen

    class LevelScreen {
        constructor(levelNumber) {
            this.levelName = 'something';
            this.levelData = LevelData[levelNumber];
            this.tiles = this.levelData.floors[0].tiles.map(row => [...row]);
            this.tileshakemap = this.levelData.floors[0].tiles.map(row => row.map(x => ({ x: 0, y: 0 })));
            this.entities = [];
            this.screenshakes = [];
            this.tileshakes = [];
            this.superslamTiles = [];
            this.t = 0;
            this.lastCloud = 0;

            this.player = new Player(qr2xy({ q: this.levelData.spawn[0], r: this.levelData.spawn[1] }));
            this.addEntity(this.player);
            this.addEntity(new StarParticle(this.player.pos));
            this.addEntity(new StarParticle(this.player.pos));
            this.addEntity(new StarParticle(this.player.pos));
            this.addEntity(new StarParticle(this.player.pos));
            this.addEntity(new CloudParticle(true));

            this.littlePigs = 0;
            this.littlePigsRescued = 0;

            this.enemies = 0;
            this.enemiesDefeated = 0;

            for (const obj of this.levelData.floors[0].objects) {
                if (obj.name === 'BOX') {
                    this.addEntity(new LittlePigBox({ q: obj.x, r: obj.y }));
                    this.littlePigs++;
                } else if (obj.name === 'KNIGHT') {
                    this.addEntity(new Knight(qr2xy({ q: obj.x, r: obj.y })));
                    this.enemies++;
                } else if (obj.name.startsWith('SIGN')) {
                    this.addEntity(new Sign({ q: obj.x, r: obj.y }, Number(obj.name.slice(4))));
                } else if (obj.name === 'SLAM') {
                    console.log('SLAM');
                    this.superslamTiles.push(this.extractSuperslamTiles({ q: obj.x, r: obj.y }));
                }
            }

            Camera.pos = { ...this.player.pos };
        }

        update() {
            this.t++;

            let levelBottomY = qr2xy({ q: 0, r: this.tiles.length - 1 }).y;
            let cameraMaxY = levelBottomY - (TARGET_GAME_HEIGHT / 2);
            Camera.forceTarget = {
                x: this.player.pos.x,
                y: Math.min(this.player.pos.y, cameraMaxY)
            };
            Camera.update();

            if (this.player.pos.y > levelBottomY) {
                this.player.dieFalling(levelBottomY);
            }

            let entities = [...this.entities];

            for (const entity of entities) {
                entity.update();
            }

            Movement.perform(this, entities);
            Attack.perform(this, entities);

            for (let i = 0; i < this.entities.length; i++) {
                if (this.entities[i].cull) {
                    this.entities.splice(i, 1);
                    i--;
                }
            }

            // Tick screenshakes and cull finished screenshakes
            for (let i = 0; i < this.screenshakes.length; i++) {
                if (!this.screenshakes[i].update()) {
                    this.screenshakes.splice(i, 1);
                    i--;
                }
            }

            // Tick tileshakes and cull finished tileshakes
            for (let i = 0; i < this.tileshakes.length; i++) {
                if ((this.tileshakes[i].s++ > 15)) {
                    this.tileshakes.splice(i, 1);
                    i--;
                }
            }

            if (this.fallingDirtCounter > 0) {
                this.fallingDirtCounter--;
                this.spawnFallingDirt();
            }

            this.spawnClouds();
        }

        draw() {
            Viewport.ctx.fillStyle = '#457cd6';
            Viewport.ctx.fillRect(0, 0, Viewport.width, Viewport.height);

            let bottomSea = 4;
            let topSea = 14;
            let percentage = Math.floor(clamp(this.player.pos.y / (this.tiles.length * TILE_SIZE), 0, Infinity) * (topSea - bottomSea) + bottomSea);

            Viewport.ctx.fillStyle = '#4b3b9c';
            Viewport.ctx.fillRect(0, Viewport.height - percentage, Viewport.width, percentage);

            /*Viewport.ctx.fillStyle = '#8fcccb';
            Viewport.ctx.fillRect(0, Viewport.height - percentage - 2, Viewport.width, 1);

            Viewport.ctx.fillStyle = '#449489';
            Viewport.ctx.fillRect(0, Viewport.height - percentage - 4, Viewport.width, 1);

            Viewport.ctx.fillStyle = '#285763';
            Viewport.ctx.fillRect(0, Viewport.height - percentage - 6, Viewport.width, 1);*/

            // Render screenshakes (canvas translation)
            let shakeX = 0, shakeY = 0;
            this.screenshakes.forEach(shake => {
                shakeX += shake.x;
                shakeY += shake.y;
            });
            Viewport.ctx.translate(shakeX, shakeY);

            for (let entity of this.entities) {
                if (entity.z === -1) entity.draw();
            }

            this.drawTileShakemap();
            this.drawTiles();

            let overlayEntities = [];

            for (let entity of this.entities) {
                if (entity.z > -1) entity.draw();

                if (entity.displayOverlay) {
                    overlayEntities.push(entity);
                }
            }

            //Text.drawText(Viewport.ctx, `${this.littlePigsRescued}/${this.littlePigs}`, 180, 5, 1, Text.duotone, Text.black);
            //Text.drawText(Viewport.ctx, 'PRESS mnop\nTO DO', 10, 100, 1, Text.tan, Text.shadow);

            for (let entity of overlayEntities) {
                entity.drawOverlay();
            }

            let pigsToShow = clamp(Math.floor(this.t / 5) - 5, 0, this.littlePigs);
            for (let i = 0; i < pigsToShow; i++) {
                let frame = (this.littlePigsRescued > i) ? 0 : 3;
                Viewport.ctx.drawImage(Sprite.littlepig[0][frame].img, Viewport.width - i * 11 - 13, 3);
            }
        }

        drawTiles() {
            const offset = xy2uv({ x: 0, y: 0 });
            const tiles = this.tiles;
            const tileshakemap = this.tileshakemap;

            // When we draw the tilesheet on the screen, we don't need to draw the ENTIRE tilesheet,
            // so let's clamp what we draw the portion on-screen (and up to one tile off-screen,
            // mostly for screenshake purposes).
            const topleft = xy2qr(uv2xy({ u: 0, v: 0 }));
            const bottomright = xy2qr(uv2xy({ u: TARGET_GAME_WIDTH, v: TARGET_GAME_HEIGHT }));
            const r1 = clamp(topleft.r - 1, 0, tiles.length - 1);
            const r2 = clamp(bottomright.r + 2, 0, tiles.length - 1);
            const q1 = clamp(topleft.q - 1, 0, tiles[0].length - 1);
            const q2 = clamp(bottomright.q + 2, 0, tiles[0].length - 1);

            // "Background" tiles
            for (let r = r1; r <= r2; r++) {
                for (let q = q1; q <= q2; q++) {
                    if (tiles[r][q] === 6) {
                        Viewport.ctx.drawImage(Sprite.tiles[tiles[r][q]].img,
                            q * TILE_SIZE + offset.u + tileshakemap[r][q].x,
                            r * TILE_SIZE + offset.v + tileshakemap[r][q].y);
                    }
                }
            }

            // "Foreground" tile outlines
            for (let r = r1; r <= r2; r++) {
                for (let q = q1; q <= q2; q++) {
                    if (tiles[r][q] > 0 && tiles[r][q] !== 6) {
                        Viewport.ctx.drawImage(Sprite.tilebg[0].img,
                            q * TILE_SIZE + offset.u - 1 + tileshakemap[r][q].x,
                            r * TILE_SIZE + offset.v - 1 + tileshakemap[r][q].y);
                    }
                }
            }

            // "Foreground" tiles
            for (let r = r1; r <= r2; r++) {
                for (let q = q1; q <= q2; q++) {
                    if (tiles[r][q] > 0 && tiles[r][q] !== 6) {
                        Viewport.ctx.drawImage(Sprite.tiles[tiles[r][q]].img,
                            q * TILE_SIZE + offset.u + tileshakemap[r][q].x,
                            r * TILE_SIZE + offset.v + tileshakemap[r][q].y);
                    }
                }
            }
        }

        drawTileShakemap() {
            for (let r = 0; r < this.tileshakemap.length; r++) {
                for (let q = 0; q < this.tileshakemap[0].length; q++) {
                    this.tileshakemap[r][q].x = 0;
                    this.tileshakemap[r][q].y = 0;
                }
            }

            for (let i = 0; i < this.tileshakes.length; i++) {
                let tileshake = this.tileshakes[i];
                for (let tile of tileshake.tiles) {
                    //this.tileshakemap[tile.r][tile.q].x += tileshake.screenshake.x;
                    let k = 0;
                    if (tileshake.s < 9) k++;
                    if (tileshake.s < 6) k++;
                    if (tileshake.s < 4) k++;
                    if (tileshake.s < 2) k++;
                    this.tileshakemap[tile.r][tile.q].y += k;
                }
            }
        }

        tileIsPassable(q, r) {
            if (r < 0 || r >= this.tiles.length) return true;
            if (q < 0 || q >= this.tiles[0].length) return true;
            return this.tiles[r][q] < 1 || this.tiles[r][q] === 6;
        }

        entityIsOnSolidGround(entity) {
            let qr = xy2qr({ x: entity.pos.x, y: entity.pos.y + entity.bb[1].y });

            return !this.tileIsPassable(qr.q, qr.r);
        }

        landedOnTile(tile, superslamFlag) {
            if (superslamFlag) {
                for (let i = 0; i < this.superslamTiles.length; i++) {
                    let slam = this.superslamTiles[i];
                    if (tile.r === slam.r && tile.q >= slam.q1 && tile.q <= slam.q2) {
                        for (let q = slam.q1; q <= slam.q2; q++) {
                            this.tiles[slam.r + 1][q] = this.tiles[slam.r][q];
                            this.tiles[slam.r][q] = this.tiles[slam.r + 1][q] === 5 ? 6 : 0;

                            let xy = this.player.pos;
                            this.addEntity(new BigArrowParticle({ x: xy.x, y: xy.y }));
                        }
                    }
                }
            }

            for (let entity of this.entities) {
                if (entity.landedOnTile) entity.landedOnTile(tile);
            }

            this.addEntity(new LandingParticle(this.pos));
            this.addEntity(new LandingParticle(this.pos));
            this.addEntity(new LandingParticle(this.pos));
            this.addEntity(new LandingParticle(this.pos));
            this.addEntity(new LandingParticle(this.pos));
            this.addEntity(new LandingParticle(this.pos));

            this.fallingDirtCounter = 4;
        }

        spawnFallingDirt() {
            for (let i = 0; i < this.superslamTiles.length; i++) {
                let slam = this.superslamTiles[i];
                let x = (slam.q1 + Math.random() * (slam.q2 + 1 - slam.q1)) * TILE_SIZE;
                let y = slam.r * TILE_SIZE + TILE_SIZE + 1;
                this.addEntity(new FallingDirtParticle({ x: x, y: y }));
            }
        }

        rescueLittlePig() {
            this.littlePigsRescued++;

            if (this.littlePigsRescued === this.littlePigs) {
                game.nextLevel++;
                game.screens.pop();
            }
        }

        addEntity(entity) {
            if (!entity.z) {
                entity.z = 1;
            }

            for (let i = 0; i < this.entities.length; i++) {
                if (this.entities[i].z > entity.z) {
                    this.entities.splice(i, 0, entity);
                    return;
                }
            }

            this.entities.push(entity);
        }

        addScreenShake(screenshake) {
            // This screen shake applies to the entire rendered screen, including GUI
            this.screenshakes.push(screenshake);
        }

        addTileShake(screenshake, originQR) {
            console.log('add tile shake');

            let tiles = [];

            for (let q = originQR.q; q >= 0; q--) {
                if (this.tileIsPassable(q, originQR.r - 1) && !this.tileIsPassable(q, originQR.r)) {
                    tiles.push({ q: q, r: originQR.r });
                } else {
                    break;
                }
            }
            for (let q = originQR.q + 1; q < this.tiles[0].length; q++) {
                if (this.tileIsPassable(q, originQR.r - 1) && !this.tileIsPassable(q, originQR.r)) {
                    tiles.push({ q: q, r: originQR.r });
                } else {
                    break;
                }
            }

            this.tileshakes.push({
                screenshake: screenshake,
                tiles: tiles,
                s: 0
            });
        }

        extractSuperslamTiles(originQR) {
            let r = originQR.r;
            let q1 = originQR.q;
            let q2 = originQR.q;

            for (let q = originQR.q; q >= 0; q--) {
                if (this.tileIsPassable(q, originQR.r + 1) && !this.tileIsPassable(q, originQR.r)) {
                    q1 = q;
                } else {
                    break;
                }
            }
            for (let q = originQR.q + 1; q < this.tiles[0].length; q++) {
                if (this.tileIsPassable(q, originQR.r + 1) && !this.tileIsPassable(q, originQR.r)) {
                    q2 = q;
                } else {
                    break;
                }
            }

            return {
                r: r,
                q1: q1,
                q2: q2
            };
        }

        spawnClouds() {
            let clouds = this.entities.filter(entity => entity instanceof CloudParticle).length;
            if (clouds < 1) {
                this.addEntity(new CloudParticle());
                this.lastCloud = this.t;
            }

            if (this.t - this.lastCloud > 60 * 5 && Math.random() < 0.01) {
                this.addEntity(new CloudParticle());
                this.lastCloud = this.t;
            }
        }
    }

    // LevelScreen

    class LoadingScreen {
        constructor() {
            this.text = [
                'HAROLD',
                'IS',
                'HEAVY'
            ];
            this.t = -12;
        }

        update() {
            this.t++;

            if (this.t === 36) {
                Audio.initTracks();
            }

            if (this.t > 65) {
                game.screens.pop();
            }
        }

        draw() {
            Viewport.ctx.fillStyle = '#2c1b2e';
            Viewport.ctx.fillRect(0, 0, Viewport.width, Viewport.height);

            Viewport.ctx.fillStyle = '#457cd6';
            Viewport.ctx.fillRect(Viewport.width / 2 - 65, Viewport.height / 2 - 8, 130, 16);
            Viewport.ctx.fillRect(Viewport.width / 2 - 64, Viewport.height / 2 - 9, 128, 18);

            let total = 10;
            let loaded = clamp(this.t / 6, 0, 10);

            for (let i = 0; i < total; i++) {
                let frame = (loaded > i) ? 0 : 3;
                let y = Math.sin(i * Math.PI * 2 / 9 + (this.t * Math.PI * 2 / 60)) * 3;
                Viewport.ctx.drawImage(Sprite.littlepig[0][frame].img, i * 12 + (Viewport.width - 120) / 2, Viewport.height / 2 - 3 + y);
            }

            this.drawInstructions();
        }

        drawInstructions() {
            let text = 'LOADING...';
            let width = Text.measure(text, 1).w;

            if (this.t % 30 < 24) {
                Text.drawText(Viewport.ctx, text, (Viewport.width - width) / 2, Viewport.height / 20 + 25, Text.duotone, Text.shadow);
            }
        }
    }

    // LevelScreen

    class IntroScreen {
        constructor() {
            this.text = [
                'HAROLD',
                'IS',
                'HEAVY'
            ];
            this.pos = [
                { y: -20 },
                { y: -20 },
                { y: -20 }
            ];
            this.vel = [
                { y: 0 },
                { y: 0 },
                { y: 0 }
            ];
            this.t = 0;
            this.fadet = -1;
        }

        update() {
            this.t++;

            this.vel[0].y = clamp(this.vel[0].y + GRAVITY, 0, TERMINAL_VELOCITY);
            if (this.pos[0].y > 15) {
                this.vel[1].y = clamp(this.vel[1].y + GRAVITY, 0, TERMINAL_VELOCITY);
            }
            if (this.pos[1].y > 15) {
                this.vel[2].y = clamp(this.vel[2].y + GRAVITY, 0, TERMINAL_VELOCITY);
            }

            if (this.pos[0].y < 45) {
                this.pos[0].y += this.vel[0].y;
            }
            if (this.pos[1].y < 60) {
                this.pos[1].y += this.vel[1].y;
            }
            if (this.pos[2].y < 75) {
                this.pos[2].y += this.vel[2].y;
            }

            if (this.fadet >= 0) this.fadet++;

            if (this.fadet > 30) {
                game.screens.pop();
                game.screens.push(new LoadingScreen());
            }

            if (Input.pressed[Input.Action.JUMP] || Input.pressed[Input.Action.CONTINUE]) {
                this.fadet = 0;
            }
        }

        draw() {
            Viewport.ctx.fillStyle = '#457cd6';
            Viewport.ctx.fillRect(0, 0, Viewport.width, Viewport.height);

            for (let i = 0; i < this.text.length; i++) {
                let width = Text.measure(this.text[i], 2).w;

                //Viewport.ctx.globalAlpha = 0.3;
                //Text.drawText(Viewport.ctx, this.text[i], (Viewport.width - width) / 2, 50 + i * 15 - 4, 2, Text.pig);

                Viewport.ctx.globalAlpha = 1;
                Text.drawText(Viewport.ctx, this.text[i], (Viewport.width - width) / 2, this.pos[i].y - 1, 2, Text.shadow);
                Text.drawText(Viewport.ctx, this.text[i], (Viewport.width - width) / 2, this.pos[i].y + 1, 2, Text.shadow);
                Text.drawText(Viewport.ctx, this.text[i], (Viewport.width - width) / 2 - 1, this.pos[i].y, 2, Text.shadow);
                Text.drawText(Viewport.ctx, this.text[i], (Viewport.width - width) / 2 + 1, this.pos[i].y, 2, Text.shadow);
                Text.drawText(Viewport.ctx, this.text[i], (Viewport.width - width) / 2, this.pos[i].y, 2, Text.pig);
            }

            if (this.pos[2].y > 50) {
                this.drawInstructions();
            }

            // Fade to load screen
            if (this.fadet >= 0) {
                let fade = 0;
                if (this.fadet > 8) {
                    fade = (this.fadet - 8) * (Viewport.width / 2 - 40) / 20;
                }

                Viewport.ctx.fillStyle = '#2c1b2e';
                Viewport.ctx.beginPath();
                Viewport.ctx.moveTo(Viewport.width / 2 - 0 - fade, 0);
                Viewport.ctx.lineTo(Viewport.width / 2 + 40 + fade, 0);
                Viewport.ctx.lineTo(Viewport.width / 2 + 0 + fade, Viewport.height);
                Viewport.ctx.lineTo(Viewport.width / 2 - 40 - fade, Viewport.height);
                Viewport.ctx.closePath();
                Viewport.ctx.fill();
            }
        }

        drawInstructions() {
            let text = 'PRESS SPACE OR ENTER TO START';
            let width = Text.measure(text, 1).w;

            if (this.t % 30 < 24) {
                Text.drawText(Viewport.ctx, text, (Viewport.width - width) / 2, Viewport.height - 10, 1, Text.white, Text.shadow);
            }
        }
    }

    // Game

    /**
     * Game state.
     */
    class Game {
        init() {
            Sprite.loadSpritesheet(() => {
                Viewport.init();
                Sprite.init();
                Text.init();
                Input.init();
                Audio.init();

                Camera.init();

                window.addEventListener('blur', () => this.pause());
                window.addEventListener('focus', () => this.unpause());

                this.reset();
                this.start();
            });
        }

        reset() {
            this.screens = [];
            this.lastFrame = 0;
            this.nextLevel = 0;

            this.screens.push(new IntroScreen());
        }

        start() {
            this.frame = 0;
            this.framestamps = [0];
            this.update();
            window.requestAnimationFrame((xyz) => this.onFrame(xyz));
        }

        onFrame(currentms) {
            let startTime= new Date().getTime();

            /*this.framestamps.push(currentms);*/
            if (this.framestamps.length >= 40) {
                this.framestamps.shift();
            }
            this.fps = 1000 / ((this.framestamps[this.framestamps.length - 1] - this.framestamps[0]) / this.framestamps.length);

            if (currentms - this.lastFrame >= 1000 / FPS) {
                this.frame++;
                this.lastFrame = currentms;
                Viewport.resize();
                this.update();
                this.draw(Viewport.ctx);
            }
            window.requestAnimationFrame((xyz) => this.onFrame(xyz));

            let endTime = new Date().getTime();
            this.framestamps.push(this.framestamps[this.framestamps.length - 1] + endTime - startTime);
        }

        update() {
            // Gather user input
            Input.update();

            // Handle special keys that are screen-independent
            if (Input.pressed[Input.Action.MUSIC_TOGGLE]) {
                Audio.musicEnabled = !Audio.musicEnabled;
            }
            if (Input.pressed[Input.Action.SFX_TOGGLE]) {
                Audio.sfxEnabled = !Audio.sfxEnabled;
            }

            // Hand off control to the current "screen" (for example, game screen or menu)
            if (this.screens.length === 0) {
                if (this.nextLevel >= LevelData.length) {
                    this.screens.push(new VictoryScreen());
                } else {
                    this.screens.push(new LevelScreen(this.nextLevel));
                }
            }
            this.screen = this.screens[this.screens.length - 1];
            this.screen.update();

            // Do per-frame audio updates
            Audio.update();
        }

        draw() {
            // Reset canvas transform and scale
            Viewport.ctx.setTransform(1, 0, 0, 1, 0, 0);
            Viewport.ctx.scale(Viewport.scale, Viewport.scale);

            this.screen.draw();
        }

        pause() {
            if (this.paused) return;
            this.paused = true;
            Audio.pause();
        }

        unpause() {
            if (!this.paused) return;
            this.paused = false;
            Audio.unpause();
        }

        restartLevel() {
            this.screens.pop();
        }
    }

    const game = new Game();

    /**
     * Create and launch game.
     */
    game.init();

})();</script>